<!DOCTYPE html>
<html lang="id">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>My Secrets - Password Manager</title>
    <!-- Bootstrap 5 -->
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <!-- Font Awesome -->
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
    />
    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Arvo:wght@400;700&family=Segoe+UI:wght@300;400;600&display=swap"
      rel="stylesheet"
    />
    <style>
      :root {
        --secret: #9b59b6;
        --secondary: #3498db;
        --danger: #e74c3c;
        --success: #27ae60;
        --warning: #f39c12;
      }
      /* Body & General */
      body {
        background: #f8f9fa;
        min-height: 100vh;
        font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
        position: relative;
        overflow-x: hidden;
      }

      /* 404 Error Page */
      .page_404 {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
        z-index: 9999;
        padding: 40px 0;
        overflow: hidden;
        font-family: "Arvo", serif;
        opacity: 0;
        animation: fadeIn 0.5s forwards;
      }

      @keyframes fadeIn {
        from {
          opacity: 0;
        }
        to {
          opacity: 1;
        }
      }

      .page_404 .container {
        display: flex;
        align-items: center;
        justify-content: center;
        min-height: 100vh;
      }

      .four_zero_four_text {
        text-align: center;
        margin-bottom: 20px;
        animation: slideDown 0.8s ease-out 0.3s both;
      }

      @keyframes slideDown {
        from {
          opacity: 0;
          transform: translateY(-50px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }

      .four_zero_four_text h1 {
        font-family: "Arvo", serif;
        font-size: 80px;
        font-weight: bold;
        color: #fff;
        margin: 0;
        text-shadow: 0 0 20px rgba(231, 76, 60, 0.5);
        position: relative;
        animation: pulse 2s infinite alternate;
      }

      @keyframes pulse {
        0% {
          text-shadow: 0 0 20px rgba(231, 76, 60, 0.5);
          transform: scale(1);
        }
        100% {
          text-shadow: 0 0 30px rgba(231, 76, 60, 0.8);
          transform: scale(1.05);
        }
      }

      .four_zero_four_bg {
        height: 300px;
        position: relative;
        margin-bottom: 30px;
        animation: float 6s ease-in-out infinite;
      }

      @keyframes float {
        0%,
        100% {
          transform: translateY(0);
        }
        50% {
          transform: translateY(-20px);
        }
      }

      .offline-icon {
        font-size: 150px;
        color: rgba(231, 76, 60, 0.7);
        position: relative;
        z-index: 1;
        animation: spin 15s linear infinite;
      }

      @keyframes spin {
        0% {
          transform: rotate(0deg);
        }
        100% {
          transform: rotate(360deg);
        }
      }

      .offline-icon:before {
        content: "";
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        width: 180px;
        height: 180px;
        background: radial-gradient(
          circle,
          rgba(231, 76, 60, 0.2) 0%,
          transparent 70%
        );
        border-radius: 50%;
        z-index: -1;
      }

      .wifi-signal {
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        width: 200px;
        height: 200px;
        z-index: 2;
      }

      .signal {
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        border: 3px solid rgba(231, 76, 60, 0.3);
        border-radius: 50%;
        animation: ripple 2s linear infinite;
      }

      .signal:nth-child(1) {
        width: 60px;
        height: 60px;
        animation-delay: 0s;
      }

      .signal:nth-child(2) {
        width: 100px;
        height: 100px;
        animation-delay: 0.3s;
      }

      .signal:nth-child(3) {
        width: 140px;
        height: 140px;
        animation-delay: 0.6s;
      }

      @keyframes ripple {
        0% {
          transform: translate(-50%, -50%) scale(0.8);
          opacity: 1;
        }
        100% {
          transform: translate(-50%, -50%) scale(1.5);
          opacity: 0;
        }
      }

      .contant_box_404 {
        text-align: center;
        margin-top: -30px;
        animation: slideUp 0.8s ease-out 0.6s both;
      }

      @keyframes slideUp {
        from {
          opacity: 0;
          transform: translateY(50px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }

      .contant_box_404 h3 {
        font-family: "Arvo", serif;
        font-size: 28px;
        margin-bottom: 15px;
        color: #fff;
      }

      .contant_box_404 p {
        font-size: 18px;
        color: rgba(255, 255, 255, 0.8);
        margin-bottom: 25px;
        line-height: 1.5;
        max-width: 600px;
        margin-left: auto;
        margin-right: auto;
      }

      .link_404 {
        color: #fff !important;
        padding: 12px 30px;
        background: #e74c3c;
        margin: 20px 10px;
        display: inline-block;
        border-radius: 50px;
        text-decoration: none;
        font-weight: 600;
        transition: all 0.3s;
        font-size: 16px;
        border: none;
        cursor: pointer;
        box-shadow: 0 4px 15px rgba(231, 76, 60, 0.3);
        position: relative;
        overflow: hidden;
        animation: bounce 2s infinite;
      }

      @keyframes bounce {
        0%,
        100% {
          transform: translateY(0);
        }
        50% {
          transform: translateY(-5px);
        }
      }

      .link_404:before {
        content: "";
        position: absolute;
        top: 0;
        left: -100%;
        width: 100%;
        height: 100%;
        background: linear-gradient(
          90deg,
          transparent,
          rgba(255, 255, 255, 0.2),
          transparent
        );
        transition: 0.5s;
      }

      .link_404:hover:before {
        left: 100%;
      }

      .link_404:hover {
        background: #c0392b;
        color: #fff !important;
        text-decoration: none;
        transform: translateY(-2px);
        box-shadow: 0 6px 20px rgba(231, 76, 60, 0.4);
      }

      /* Tombol alternatif */
      .btn-alt {
        background: var(--secondary) !important;
        box-shadow: 0 4px 15px rgba(52, 152, 219, 0.3);
      }

      .btn-alt:hover {
        background: #2980b9 !important;
        box-shadow: 0 6px 20px rgba(52, 152, 219, 0.4);
      }

      /* Offline Indicator */
      .offline-indicator {
        position: fixed;
        top: 20px;
        right: 20px;
        background: linear-gradient(135deg, #e74c3c, #c0392b);
        color: white;
        padding: 12px 20px;
        border-radius: 50px;
        display: none;
        z-index: 1000;
        box-shadow: 0 5px 15px rgba(231, 76, 60, 0.4);
        font-size: 14px;
        animation: slideInRight 0.5s ease-out, pulse 2s infinite 0.5s;
        transform: translateX(100px);
        opacity: 0;
      }

      @keyframes slideInRight {
        to {
          transform: translateX(0);
          opacity: 1;
        }
      }

      @keyframes pulse {
        0%,
        100% {
          box-shadow: 0 5px 15px rgba(231, 76, 60, 0.4);
        }
        50% {
          box-shadow: 0 5px 20px rgba(231, 76, 60, 0.6);
        }
      }

      /* Animasi untuk status online */
      .online-indicator {
        position: fixed;
        top: 20px;
        right: 20px;
        background: linear-gradient(135deg, #27ae60, #229954);
        color: white;
        padding: 12px 20px;
        border-radius: 50px;
        display: none;
        z-index: 1000;
        box-shadow: 0 5px 15px rgba(39, 174, 96, 0.4);
        font-size: 14px;
        animation: slideInRight 0.5s ease-out, successPulse 2s infinite 0.5s;
        transform: translateX(100px);
        opacity: 0;
      }

      @keyframes successPulse {
        0%,
        100% {
          box-shadow: 0 5px 15px rgba(39, 174, 96, 0.4);
        }
        50% {
          box-shadow: 0 5px 20px rgba(39, 174, 96, 0.6);
        }
      }

      /* Login Screen */
      .login-screen {
        display: flex;
        align-items: center;
        justify-content: center;
        min-height: 100vh;
        padding: 20px;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      }

      .login-card {
        background: white;
        border-radius: 15px;
        box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);
        padding: 2.5rem;
        width: 100%;
        max-width: 400px;
      }

      .login-icon {
        color: var(--secret);
        font-size: 3rem;
        margin-bottom: 1rem;
        text-align: center;
      }

      /* Dashboard */
      .dashboard {
        display: none;
      }

      .navbar {
        background: white;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
      }

      .hero-section {
        background: linear-gradient(135deg, var(--secret) 0%, #8e44ad 100%);
        color: white;
        padding: 2rem 0;
        margin-bottom: 2rem;
      }

      /* Category Card */
      .category-card {
        background: white;
        border-radius: 10px;
        box-shadow: 0 3px 15px rgba(0, 0, 0, 0.1);
        margin-bottom: 1.5rem;
        overflow: hidden;
        border: 2px solid var(--secret);
        transition: transform 0.3s;
      }

      .category-card:hover {
        transform: translateY(-5px);
      }

      .category-header {
        padding: 1.25rem;
        background: rgba(155, 89, 182, 0.05);
        border-bottom: 1px solid rgba(155, 89, 182, 0.1);
        cursor: pointer;
        transition: background 0.3s;
      }

      .category-header:hover {
        background: rgba(155, 89, 182, 0.1);
      }

      .category-content {
        padding: 1.25rem;
      }

      /* Item Card */
      .item-card {
        background: #f8f9fa;
        border-radius: 8px;
        padding: 1rem;
        margin-bottom: 1rem;
        border-left: 4px solid var(--secondary);
        transition: all 0.3s;
      }

      .item-card:hover {
        background: #e9ecef;
      }

      .btn-secret {
        background: var(--secret);
        color: white;
        border: none;
        transition: all 0.3s;
      }

      .btn-secret:hover {
        background: #8e44ad;
        color: white;
        transform: translateY(-2px);
        box-shadow: 0 4px 10px rgba(155, 89, 182, 0.3);
      }

      .floating-btn {
        position: fixed;
        bottom: 2rem;
        right: 2rem;
        width: 60px;
        height: 60px;
        border-radius: 50%;
        background: var(--secret);
        color: white;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 1.5rem;
        box-shadow: 0 5px 20px rgba(155, 89, 182, 0.5);
        transition: all 0.3s;
        z-index: 100;
      }

      .floating-btn:hover {
        background: #8e44ad;
        transform: scale(1.1);
      }

      .stats-card {
        background: white;
        border-radius: 10px;
        padding: 1.25rem;
        box-shadow: 0 3px 10px rgba(0, 0, 0, 0.1);
        margin-bottom: 1rem;
        text-align: center;
        transition: transform 0.3s;
      }

      .stats-card:hover {
        transform: translateY(-5px);
      }

      .badge-category {
        background: var(--secret);
        color: white;
        padding: 0.25rem 0.5rem;
        border-radius: 4px;
        font-size: 0.8rem;
      }

      .error-message {
        color: var(--danger);
        font-size: 0.9rem;
        margin-top: 0.5rem;
        display: none;
      }

      .password-field {
        position: relative;
      }

      .password-field input {
        padding-right: 40px;
      }

      .toggle-password {
        position: absolute;
        right: 10px;
        top: 50%;
        transform: translateY(-50%);
        background: none;
        border: none;
        color: #6c757d;
        cursor: pointer;
      }

      /* Responsive */
      @media (max-width: 768px) {
        .four_zero_four_text h1 {
          font-size: 60px;
        }

        .offline-icon {
          font-size: 120px;
        }

        .offline-icon:before {
          width: 150px;
          height: 150px;
        }

        .wifi-signal {
          width: 160px;
          height: 160px;
        }

        .signal:nth-child(3) {
          width: 120px;
          height: 120px;
        }

        .contant_box_404 h3 {
          font-size: 22px;
        }

        .contant_box_404 p {
          font-size: 16px;
        }

        .link_404 {
          display: block;
          margin: 10px auto;
          width: 80%;
          max-width: 250px;
        }

        .login-card {
          padding: 1.5rem;
        }
      }
    </style>
  </head>
  <body>
    <!-- Offline Indicator -->
    <div class="offline-indicator" id="offlineIndicator">
      <i class="fas fa-wifi-slash me-2"></i>Anda sedang offline
    </div>

    <!-- Online Indicator -->
    <div class="online-indicator" id="onlineIndicator">
      <i class="fas fa-wifi me-2"></i>Koneksi internet pulih
    </div>

    <!-- 404 Error Page (Hidden by default) -->
    <section class="page_404" id="page404">
      <div class="container">
        <div class="row justify-content-center">
          <div class="col-sm-12 text-center">
            <div class="four_zero_four_text">
              <h1><strong>404</strong></h1>
            </div>

            <div class="four_zero_four_bg">
              <div class="offline-icon">
                <i class="fas fa-wifi-slash"></i>
              </div>
              <div class="wifi-signal">
                <div class="signal"></div>
                <div class="signal"></div>
                <div class="signal"></div>
              </div>
            </div>

            <div class="contant_box_404">
              <h3 class="h2">Sepertinya Anda sedang offline</h3>

              <p>
                Aplikasi membutuhkan koneksi internet untuk bekerja dengan
                optimal. Data Anda tetap aman di browser.
              </p>
              <p>
                Pastikan perangkat Anda terhubung ke internet, lalu coba refresh
                halaman.
              </p>

              <button class="link_404" onclick="checkConnection()">
                <i class="fas fa-redo me-2"></i>Coba Lagi
              </button>
              <button class="link_404 btn-alt" onclick="goToDashboard()">
                <i class="fas fa-home me-2"></i>Ke Dashboard
              </button>
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- Login Screen -->
    <div class="login-screen" id="loginScreen">
      <div class="login-card">
        <div class="login-icon">
          <i class="fas fa-user-secret"></i>
        </div>

        <h3 class="text-center mb-4">My Secrets</h3>

        <!-- Setup Form (muncul pertama kali) -->
        <div id="setupForm">
          <div class="mb-3">
            <label class="form-label">Buat Username</label>
            <input
              type="text"
              class="form-control"
              id="setupUsername"
              placeholder="Pilih username Anda"
            />
          </div>

          <div class="mb-3">
            <label class="form-label">Buat Password</label>
            <div class="password-field">
              <input
                type="password"
                class="form-control"
                id="setupPassword"
                placeholder="Minimal 6 karakter"
              />
              <button
                class="toggle-password"
                type="button"
                onclick="toggleSetupPassword()"
              >
                <i class="fas fa-eye"></i>
              </button>
            </div>
          </div>

          <div class="mb-3">
            <label class="form-label">Konfirmasi Password</label>
            <div class="password-field">
              <input
                type="password"
                class="form-control"
                id="setupConfirmPassword"
                placeholder="Ketik ulang password"
              />
              <button
                class="toggle-password"
                type="button"
                onclick="toggleSetupConfirmPassword()"
              >
                <i class="fas fa-eye"></i>
              </button>
            </div>
          </div>

          <button class="btn btn-secret w-100 mb-3" onclick="setupAccount()">
            <i class="fas fa-user-plus me-2"></i> Buat Akun
          </button>
        </div>

        <!-- Login Form (muncul setelah setup) -->
        <div id="loginForm" style="display: none">
          <div class="mb-3">
            <label class="form-label">Username</label>
            <input
              type="text"
              class="form-control"
              id="loginUsername"
              placeholder="Masukkan username"
            />
          </div>

          <div class="mb-3">
            <label class="form-label">Password</label>
            <div class="password-field">
              <input
                type="password"
                class="form-control"
                id="loginPassword"
                placeholder="Masukkan password"
              />
              <button
                class="toggle-password"
                type="button"
                onclick="toggleLoginPassword()"
              >
                <i class="fas fa-eye"></i>
              </button>
            </div>
          </div>

          <div id="loginError" class="error-message">
            <i class="fas fa-exclamation-circle me-1"></i>
            Username atau password salah!
          </div>

          <button class="btn btn-secret w-100 mb-3" onclick="login()">
            <i class="fas fa-sign-in-alt me-2"></i> Login
          </button>

          <div class="text-center">
            <small class="text-muted">
              <i class="fas fa-info-circle me-1"></i>
              Data disimpan di browser Anda
            </small>
          </div>
        </div>
      </div>
    </div>

    <!-- Dashboard -->
    <div class="dashboard" id="dashboard">
      <!-- Navbar -->
      <nav class="navbar navbar-expand-lg navbar-light sticky-top">
        <div class="container">
          <a class="navbar-brand fw-bold" href="#">
            <i class="fas fa-user-secret me-2"></i>My Secrets
          </a>
          <div class="navbar-nav ms-auto">
            <div class="nav-item dropdown">
              <a
                class="nav-link dropdown-toggle"
                href="#"
                data-bs-toggle="dropdown"
              >
                <i class="fas fa-user-circle me-1"></i>
                <span id="currentUserDisplay">User</span>
              </a>
              <ul class="dropdown-menu">
                <li>
                  <a class="dropdown-item" href="#" onclick="logout()">
                    <i class="fas fa-sign-out-alt me-2"></i>Logout
                  </a>
                </li>
              </ul>
            </div>
          </div>
        </div>
      </nav>

      <!-- Hero Section -->
      <section class="hero-section">
        <div class="container">
          <h1 class="display-6 fw-bold mb-2">My Secrets</h1>
          <p class="mb-0">
            Selamat datang, <span id="welcomeUser">User</span>!
          </p>
        </div>
      </section>

      <!-- Stats -->
      <section class="container mb-4">
        <div class="row g-3">
          <div class="col-6 col-md-3">
            <div class="stats-card">
              <div class="stats-number" id="totalCategories">0</div>
              <div class="stats-label">Kategori</div>
            </div>
          </div>
          <div class="col-6 col-md-3">
            <div class="stats-card">
              <div class="stats-number" id="totalItems">0</div>
              <div class="stats-label">Total Akun</div>
            </div>
          </div>
          <div class="col-6 col-md-3">
            <div class="stats-card">
              <div class="stats-number" id="socialMediaCount">0</div>
              <div class="stats-label">Media Sosial</div>
            </div>
          </div>
          <div class="col-6 col-md-3">
            <div class="stats-card">
              <div class="stats-number" id="emailCount">0</div>
              <div class="stats-label">Email</div>
            </div>
          </div>
        </div>
      </section>

      <!-- Main Content -->
      <section class="container mb-5">
        <div class="d-flex justify-content-between align-items-center mb-4">
          <h4>Semua Kategori</h4>
          <button
            class="btn btn-secret btn-sm"
            data-bs-toggle="modal"
            data-bs-target="#addCategoryModal"
          >
            <i class="fas fa-plus me-1"></i> Tambah Kategori
          </button>
        </div>

        <div id="categoriesContainer">
          <!-- Kategori akan ditampilkan di sini -->
        </div>

        <div id="emptyState" class="text-center py-5">
          <i class="fas fa-user-secret fa-3x text-muted mb-3"></i>
          <h5 class="text-muted mb-3">Belum Ada Kategori</h5>
          <p class="text-muted mb-4">
            Mulai tambahkan kategori untuk menyimpan akun Anda
          </p>
          <button
            class="btn btn-secret"
            data-bs-toggle="modal"
            data-bs-target="#addCategoryModal"
          >
            <i class="fas fa-plus me-2"></i> Tambah Kategori Pertama
          </button>
        </div>
      </section>

      <!-- Footer -->
      <footer class="bg-light py-3 mt-5">
        <div class="container text-center">
          <small class="text-muted">
            &copy; 2023 My Secrets â€¢ Data disimpan di browser
          </small>
        </div>
      </footer>

      <!-- Floating Button -->
      <div
        class="floating-btn"
        data-bs-toggle="modal"
        data-bs-target="#addCategoryModal"
      >
        <i class="fas fa-plus"></i>
      </div>

      <!-- Add Category Modal -->
      <div class="modal fade" id="addCategoryModal" tabindex="-1">
        <div class="modal-dialog">
          <div class="modal-content">
            <div class="modal-header">
              <h5 class="modal-title">Tambah Kategori</h5>
              <button
                type="button"
                class="btn-close"
                data-bs-dismiss="modal"
              ></button>
            </div>
            <div class="modal-body">
              <div class="mb-3">
                <label class="form-label">Nama Kategori</label>
                <input
                  type="text"
                  class="form-control"
                  id="categoryName"
                  placeholder="Contoh: Media Sosial, Email, dll"
                />
              </div>
              <div class="mb-3">
                <label class="form-label">Deskripsi (opsional)</label>
                <textarea
                  class="form-control"
                  id="categoryDescription"
                  rows="2"
                ></textarea>
              </div>
            </div>
            <div class="modal-footer">
              <button
                type="button"
                class="btn btn-secondary"
                data-bs-dismiss="modal"
              >
                Batal
              </button>
              <button
                type="button"
                class="btn btn-secret"
                onclick="saveCategory()"
              >
                Simpan
              </button>
            </div>
          </div>
        </div>
      </div>

      <!-- Add Item Modal -->
      <div class="modal fade" id="addItemModal" tabindex="-1">
        <div class="modal-dialog">
          <div class="modal-content">
            <div class="modal-header">
              <h5 class="modal-title">Tambah Akun</h5>
              <button
                type="button"
                class="btn-close"
                data-bs-dismiss="modal"
              ></button>
            </div>
            <div class="modal-body">
              <input type="hidden" id="itemCategoryId" />
              <div class="mb-3">
                <label class="form-label">Nama Akun</label>
                <input
                  type="text"
                  class="form-control"
                  id="itemName"
                  placeholder="Contoh: Instagram, Facebook, dll"
                />
              </div>
              <div class="mb-3">
                <label class="form-label">Username/Email</label>
                <input
                  type="text"
                  class="form-control"
                  id="itemUsername"
                  placeholder="username@email.com"
                />
              </div>
              <div class="mb-3">
                <label class="form-label">Password</label>
                <div class="password-field">
                  <input
                    type="password"
                    class="form-control"
                    id="itemPassword"
                    placeholder="Password"
                  />
                  <button
                    class="toggle-password"
                    type="button"
                    onclick="toggleItemPassword()"
                  >
                    <i class="fas fa-eye"></i>
                  </button>
                </div>
              </div>
              <div class="mb-3">
                <label class="form-label">Catatan (opsional)</label>
                <textarea
                  class="form-control"
                  id="itemNotes"
                  rows="2"
                ></textarea>
              </div>
            </div>
            <div class="modal-footer">
              <button
                type="button"
                class="btn btn-secondary"
                data-bs-dismiss="modal"
              >
                Batal
              </button>
              <button type="button" class="btn btn-secret" onclick="saveItem()">
                Simpan
              </button>
            </div>
          </div>
        </div>
      </div>

      <!-- View Item Modal -->
      <div class="modal fade" id="viewItemModal" tabindex="-1">
        <div class="modal-dialog">
          <div class="modal-content">
            <div class="modal-header">
              <h5 class="modal-title" id="viewItemTitle">Detail Akun</h5>
              <button
                type="button"
                class="btn-close"
                data-bs-dismiss="modal"
              ></button>
            </div>
            <div class="modal-body">
              <div class="mb-3">
                <strong>Username:</strong>
                <div class="mt-1" id="viewItemUsername"></div>
              </div>
              <div class="mb-3">
                <strong>Password:</strong>
                <div class="password-field mt-1">
                  <input
                    type="password"
                    class="form-control"
                    id="viewItemPassword"
                    readonly
                  />
                  <button
                    class="toggle-password"
                    type="button"
                    onclick="toggleViewPassword()"
                  >
                    <i class="fas fa-eye"></i>
                  </button>
                  <button
                    class="btn btn-outline-secondary btn-sm ms-2"
                    type="button"
                    onclick="copyPassword()"
                  >
                    <i class="fas fa-copy"></i> Salin
                  </button>
                </div>
              </div>
              <div class="mb-3" id="viewItemNotesContainer">
                <strong>Catatan:</strong>
                <div class="mt-1" id="viewItemNotes"></div>
              </div>
            </div>
            <div class="modal-footer">
              <button
                type="button"
                class="btn btn-secondary"
                data-bs-dismiss="modal"
              >
                Tutup
              </button>
              <button
                type="button"
                class="btn btn-warning"
                onclick="editCurrentItem()"
              >
                Edit
              </button>
              <button
                type="button"
                class="btn btn-danger"
                onclick="deleteCurrentItem()"
              >
                Hapus
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
      // Data storage
      let categories = [];
      let currentItemId = null;
      let currentCategoryId = null;
      let currentUser = null;
      let isOnline = navigator.onLine;
      let onlineIndicatorTimeout = null;

      // Initialize
      document.addEventListener("DOMContentLoaded", function () {
        // Check connection status
        checkConnection();

        // Set up online/offline event listeners
        window.addEventListener("online", handleOnlineStatus);
        window.addEventListener("offline", handleOnlineStatus);

        // Check if account exists
        checkIfAccountExists();
      });

      // Handle online/offline status
      function handleOnlineStatus() {
        isOnline = navigator.onLine;

        if (isOnline) {
          // Online - hide 404 page
          document.getElementById("page404").style.display = "none";
          document.getElementById("offlineIndicator").style.display = "none";

          // Show online indicator
          showOnlineIndicator();

          // Show appropriate screen
          if (currentUser) {
            document.getElementById("dashboard").style.display = "block";
          } else {
            document.getElementById("loginScreen").style.display = "flex";
          }
        } else {
          // Offline - show 404 page
          document.getElementById("page404").style.display = "block";
          document.getElementById("offlineIndicator").style.display = "block";

          // Hide other screens
          document.getElementById("loginScreen").style.display = "none";
          document.getElementById("dashboard").style.display = "none";

          // Hide online indicator if visible
          document.getElementById("onlineIndicator").style.display = "none";
        }
      }

      // Show online indicator
      function showOnlineIndicator() {
        const onlineIndicator = document.getElementById("onlineIndicator");
        onlineIndicator.style.display = "block";

        // Auto-hide after 3 seconds
        clearTimeout(onlineIndicatorTimeout);
        onlineIndicatorTimeout = setTimeout(() => {
          onlineIndicator.style.display = "none";
        }, 3000);
      }

      // Check connection manually
      function checkConnection() {
        if (navigator.onLine) {
          // Online
          handleOnlineStatus();

          // If we were on the 404 page, show success message
          if (document.getElementById("page404").style.display === "block") {
            alert("Koneksi internet telah pulih! Aplikasi siap digunakan.");
          }
        } else {
          // Offline
          handleOnlineStatus();
        }
      }

      // Go to dashboard (from 404 page)
      function goToDashboard() {
        if (isOnline) {
          document.getElementById("page404").style.display = "none";

          if (currentUser) {
            document.getElementById("dashboard").style.display = "block";
          } else {
            document.getElementById("loginScreen").style.display = "flex";
          }
        } else {
          alert("Anda masih offline. Silakan cek koneksi internet Anda.");
        }
      }

      // Check if account exists in localStorage
      function checkIfAccountExists() {
        const savedUser = localStorage.getItem("secretManagerUser");
        const savedPass = localStorage.getItem("secretManagerPass");

        if (savedUser && savedPass) {
          // Account exists, show login form
          document.getElementById("setupForm").style.display = "none";
          document.getElementById("loginForm").style.display = "block";

          // Auto-fill username
          document.getElementById("loginUsername").value = savedUser;
        } else {
          // No account, show setup form
          document.getElementById("setupForm").style.display = "block";
          document.getElementById("loginForm").style.display = "none";
        }
      }

      // Toggle password visibility functions
      function toggleSetupPassword() {
        const input = document.getElementById("setupPassword");
        const icon = event.target.closest("button").querySelector("i");
        togglePasswordVisibility(input, icon);
      }

      function toggleSetupConfirmPassword() {
        const input = document.getElementById("setupConfirmPassword");
        const icon = event.target.closest("button").querySelector("i");
        togglePasswordVisibility(input, icon);
      }

      function toggleLoginPassword() {
        const input = document.getElementById("loginPassword");
        const icon = event.target.closest("button").querySelector("i");
        togglePasswordVisibility(input, icon);
      }

      function toggleItemPassword() {
        const input = document.getElementById("itemPassword");
        const icon = event.target.closest("button").querySelector("i");
        togglePasswordVisibility(input, icon);
      }

      function toggleViewPassword() {
        const input = document.getElementById("viewItemPassword");
        const icon = event.target.closest("button").querySelector("i");
        togglePasswordVisibility(input, icon);
      }

      function togglePasswordVisibility(input, icon) {
        if (input.type === "password") {
          input.type = "text";
          icon.className = "fas fa-eye-slash";
        } else {
          input.type = "password";
          icon.className = "fas fa-eye";
        }
      }

      // Setup new account
      function setupAccount() {
        if (!isOnline) {
          alert("Anda harus online untuk membuat akun pertama kali.");
          return;
        }

        const username = document.getElementById("setupUsername").value.trim();
        const password = document.getElementById("setupPassword").value;
        const confirmPassword = document.getElementById(
          "setupConfirmPassword"
        ).value;

        // Validation
        if (!username || username.length < 3) {
          alert("Username minimal 3 karakter!");
          return;
        }

        if (!password || password.length < 6) {
          alert("Password minimal 6 karakter!");
          return;
        }

        if (password !== confirmPassword) {
          alert("Password tidak cocok!");
          return;
        }

        // Save to localStorage
        localStorage.setItem("secretManagerUser", username);
        localStorage.setItem("secretManagerPass", password);

        // Set current user
        currentUser = username;

        // Switch to login form
        document.getElementById("setupForm").style.display = "none";
        document.getElementById("loginForm").style.display = "block";

        // Auto-fill login form
        document.getElementById("loginUsername").value = username;

        alert("Akun berhasil dibuat! Silakan login.");
      }

      // Login function
      function login() {
        const username = document.getElementById("loginUsername").value.trim();
        const password = document.getElementById("loginPassword").value;

        // Get saved credentials
        const savedUser = localStorage.getItem("secretManagerUser");
        const savedPass = localStorage.getItem("secretManagerPass");

        // Check credentials
        if (username === savedUser && password === savedPass) {
          // Login success
          currentUser = username;
          showDashboard();
        } else {
          // Login failed
          document.getElementById("loginError").style.display = "block";
          setTimeout(() => {
            document.getElementById("loginError").style.display = "none";
          }, 3000);
        }
      }

      // Show dashboard
      function showDashboard() {
        // Check if online
        if (!isOnline) {
          alert("Anda sedang offline. Beberapa fitur mungkin terbatas.");
        }

        // Load categories for current user
        loadUserCategories();

        // Update UI
        document.getElementById("welcomeUser").textContent = currentUser;
        document.getElementById("currentUserDisplay").textContent = currentUser;

        // Switch screens
        document.getElementById("loginScreen").style.display = "none";
        document.getElementById("dashboard").style.display = "block";

        // Render categories
        renderCategories();
        updateStats();
      }

      // Load categories for current user
      function loadUserCategories() {
        const userCategories = localStorage.getItem(
          `secretCategories_${currentUser}`
        );
        categories = userCategories ? JSON.parse(userCategories) : [];
      }

      // Save categories for current user
      function saveUserCategories() {
        localStorage.setItem(
          `secretCategories_${currentUser}`,
          JSON.stringify(categories)
        );
      }

      // Logout
      function logout() {
        if (confirm("Apakah Anda yakin ingin logout?")) {
          currentUser = null;
          document.getElementById("loginScreen").style.display = "flex";
          document.getElementById("dashboard").style.display = "none";

          // Clear login form
          document.getElementById("loginPassword").value = "";
        }
      }

      // Save category
      function saveCategory() {
        const name = document.getElementById("categoryName").value;
        const description = document.getElementById(
          "categoryDescription"
        ).value;

        if (!name) {
          alert("Nama kategori harus diisi!");
          return;
        }

        const category = {
          id: Date.now(),
          name,
          description,
          items: [],
          createdAt: new Date().toISOString(),
        };

        categories.push(category);
        saveUserCategories();
        renderCategories();
        updateStats();

        // Reset form and close modal
        document.getElementById("categoryName").value = "";
        document.getElementById("categoryDescription").value = "";
        bootstrap.Modal.getInstance(
          document.getElementById("addCategoryModal")
        ).hide();

        alert("Kategori berhasil ditambahkan!");
      }

      // Save item
      function saveItem() {
        const categoryId = parseInt(
          document.getElementById("itemCategoryId").value
        );
        const name = document.getElementById("itemName").value;
        const username = document.getElementById("itemUsername").value;
        const password = document.getElementById("itemPassword").value;
        const notes = document.getElementById("itemNotes").value;

        if (!name || !username || !password) {
          alert("Nama, username, dan password harus diisi!");
          return;
        }

        const category = categories.find((c) => c.id === categoryId);
        if (!category) return;

        const item = {
          id: Date.now(),
          name,
          username,
          password,
          notes,
          createdAt: new Date().toISOString(),
        };

        category.items.push(item);
        saveUserCategories();
        renderCategories();
        updateStats();

        // Reset form and close modal
        document.getElementById("itemName").value = "";
        document.getElementById("itemUsername").value = "";
        document.getElementById("itemPassword").value = "";
        document.getElementById("itemNotes").value = "";
        bootstrap.Modal.getInstance(
          document.getElementById("addItemModal")
        ).hide();

        alert("Akun berhasil ditambahkan!");
      }

      // Delete category
      function deleteCategory(id) {
        if (
          !confirm(
            "Hapus kategori ini? Semua akun di dalamnya juga akan terhapus!"
          )
        )
          return;

        categories = categories.filter((c) => c.id !== id);
        saveUserCategories();
        renderCategories();
        updateStats();
        alert("Kategori berhasil dihapus!");
      }

      // Delete item
      function deleteItem(categoryId, itemId) {
        if (!confirm("Hapus akun ini?")) return;

        const category = categories.find((c) => c.id === categoryId);
        if (category) {
          category.items = category.items.filter((i) => i.id !== itemId);
          saveUserCategories();
          renderCategories();
          updateStats();
          alert("Akun berhasil dihapus!");
        }
      }

      // Toggle category content
      function toggleCategory(id) {
        const content = document.getElementById(`category-content-${id}`);
        const icon = document.getElementById(`category-icon-${id}`);

        if (content.style.display === "none") {
          content.style.display = "block";
          icon.className = "fas fa-chevron-up";
        } else {
          content.style.display = "none";
          icon.className = "fas fa-chevron-down";
        }
      }

      // Open add item modal
      function openAddItemModal(categoryId) {
        document.getElementById("itemCategoryId").value = categoryId;
        new bootstrap.Modal(document.getElementById("addItemModal")).show();
      }

      // View item details
      function viewItem(categoryId, itemId) {
        const category = categories.find((c) => c.id === categoryId);
        if (!category) return;

        const item = category.items.find((i) => i.id === itemId);
        if (!item) return;

        currentItemId = itemId;
        currentCategoryId = categoryId;

        // Populate modal
        document.getElementById("viewItemTitle").textContent = item.name;
        document.getElementById("viewItemUsername").textContent = item.username;
        document.getElementById("viewItemPassword").value = item.password;

        if (item.notes) {
          document.getElementById("viewItemNotesContainer").style.display =
            "block";
          document.getElementById("viewItemNotes").textContent = item.notes;
        } else {
          document.getElementById("viewItemNotesContainer").style.display =
            "none";
        }

        // Show modal
        new bootstrap.Modal(document.getElementById("viewItemModal")).show();
      }

      // Edit current item
      function editCurrentItem() {
        if (!currentCategoryId || !currentItemId) return;

        const category = categories.find((c) => c.id === currentCategoryId);
        if (!category) return;

        const item = category.items.find((i) => i.id === currentItemId);
        if (!item) return;

        // Populate form
        document.getElementById("itemCategoryId").value = currentCategoryId;
        document.getElementById("itemName").value = item.name;
        document.getElementById("itemUsername").value = item.username;
        document.getElementById("itemPassword").value = item.password;
        document.getElementById("itemNotes").value = item.notes || "";

        // Update button text
        const saveBtn = document.querySelector("#addItemModal .btn-secret");
        saveBtn.textContent = "Update Akun";
        saveBtn.onclick = updateItem;

        // Close view modal and open edit modal
        bootstrap.Modal.getInstance(
          document.getElementById("viewItemModal")
        ).hide();
        new bootstrap.Modal(document.getElementById("addItemModal")).show();
      }

      // Update item
      function updateItem() {
        if (!currentCategoryId || !currentItemId) return;

        const category = categories.find((c) => c.id === currentCategoryId);
        if (!category) return;

        const itemIndex = category.items.findIndex(
          (i) => i.id === currentItemId
        );
        if (itemIndex === -1) return;

        const name = document.getElementById("itemName").value;
        const username = document.getElementById("itemUsername").value;
        const password = document.getElementById("itemPassword").value;
        const notes = document.getElementById("itemNotes").value;

        if (!name || !username || !password) {
          alert("Nama, username, dan password harus diisi!");
          return;
        }

        category.items[itemIndex] = {
          ...category.items[itemIndex],
          name,
          username,
          password,
          notes,
          updatedAt: new Date().toISOString(),
        };

        saveUserCategories();
        renderCategories();
        updateStats();

        // Reset
        document.getElementById("itemName").value = "";
        document.getElementById("itemUsername").value = "";
        document.getElementById("itemPassword").value = "";
        document.getElementById("itemNotes").value = "";
        const saveBtn = document.querySelector("#addItemModal .btn-secret");
        saveBtn.textContent = "Simpan Akun";
        saveBtn.onclick = saveItem;

        currentItemId = null;
        currentCategoryId = null;

        // Close modal
        bootstrap.Modal.getInstance(
          document.getElementById("addItemModal")
        ).hide();

        alert("Akun berhasil diperbarui!");
      }

      // Delete current item
      function deleteCurrentItem() {
        if (!currentCategoryId || !currentItemId) return;

        if (!confirm("Hapus akun ini?")) return;

        const category = categories.find((c) => c.id === currentCategoryId);
        if (category) {
          category.items = category.items.filter((i) => i.id !== currentItemId);
          saveUserCategories();
          renderCategories();
          updateStats();

          bootstrap.Modal.getInstance(
            document.getElementById("viewItemModal")
          ).hide();
          currentItemId = null;
          currentCategoryId = null;

          alert("Akun berhasil dihapus!");
        }
      }

      // Copy password to clipboard
      function copyPassword() {
        const password = document.getElementById("viewItemPassword").value;
        navigator.clipboard.writeText(password).then(() => {
          alert("Password disalin ke clipboard!");
        });
      }

      // Render categories
      function renderCategories() {
        const container = document.getElementById("categoriesContainer");
        const emptyState = document.getElementById("emptyState");

        if (categories.length === 0) {
          container.style.display = "none";
          emptyState.style.display = "block";
        } else {
          container.style.display = "block";
          emptyState.style.display = "none";
          container.innerHTML = "";

          categories.forEach((category) => {
            const categoryCard = document.createElement("div");
            categoryCard.className = "category-card";

            categoryCard.innerHTML = `
              <div class="category-header" onclick="toggleCategory(${
                category.id
              })">
                <div class="d-flex justify-content-between align-items-center">
                  <div>
                    <h5 class="mb-1">${category.name}</h5>
                    <p class="mb-0 text-muted">
                      <span class="badge-category">${
                        category.items.length
                      } akun</span>
                      ${
                        category.description
                          ? `<span class="ms-2">${category.description}</span>`
                          : ""
                      }
                    </p>
                  </div>
                  <i id="category-icon-${
                    category.id
                  }" class="fas fa-chevron-down"></i>
                </div>
              </div>
              <div class="category-content" id="category-content-${
                category.id
              }" style="display: none;">
                <div class="d-flex justify-content-end mb-3">
                  <button class="btn btn-sm btn-secret me-2" onclick="openAddItemModal(${
                    category.id
                  })">
                    <i class="fas fa-plus me-1"></i> Tambah Akun
                  </button>
                  <button class="btn btn-sm btn-outline-danger" onclick="deleteCategory(${
                    category.id
                  })">
                    <i class="fas fa-trash"></i>
                  </button>
                </div>
                
                <div class="items-list">
                  ${
                    category.items.length > 0
                      ? category.items
                          .map(
                            (item) => `
                        <div class="item-card">
                          <div class="d-flex justify-content-between align-items-center">
                            <div>
                              <h6 class="mb-1">${item.name}</h6>
                              <small class="text-muted">${item.username}</small>
                            </div>
                            <div>
                              <button class="btn btn-sm btn-outline-primary me-1" onclick="viewItem(${category.id}, ${item.id})">
                                <i class="fas fa-eye"></i>
                              </button>
                              <button class="btn btn-sm btn-outline-danger" onclick="deleteItem(${category.id}, ${item.id})">
                                <i class="fas fa-trash"></i>
                              </button>
                            </div>
                          </div>
                        </div>
                      `
                          )
                          .join("")
                      : `
                        <div class="text-center py-3 text-muted">
                          <p>Belum ada akun di kategori ini</p>
                        </div>
                      `
                  }
                </div>
              </div>
            `;

            container.appendChild(categoryCard);
          });
        }
      }

      // Update statistics
      function updateStats() {
        const totalCategories = categories.length;
        let totalItems = 0;
        let socialMediaCount = 0;
        let emailCount = 0;

        categories.forEach((category) => {
          totalItems += category.items.length;

          const lowerName = category.name.toLowerCase();
          if (
            lowerName.includes("media sosial") ||
            lowerName.includes("instagram") ||
            lowerName.includes("facebook") ||
            lowerName.includes("twitter") ||
            lowerName.includes("tiktok") ||
            lowerName.includes("whatsapp")
          ) {
            socialMediaCount += category.items.length;
          } else if (
            lowerName.includes("email") ||
            lowerName.includes("gmail")
          ) {
            emailCount += category.items.length;
          }
        });

        document.getElementById("totalCategories").textContent =
          totalCategories;
        document.getElementById("totalItems").textContent = totalItems;
        document.getElementById("socialMediaCount").textContent =
          socialMediaCount;
        document.getElementById("emailCount").textContent = emailCount;
      }
    </script>
  </body>
</html>
