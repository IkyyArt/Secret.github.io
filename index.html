<!DOCTYPE html>
<html lang="id">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>My Secrets - Password Manager</title>
    <!-- Bootstrap 5 -->
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <!-- Font Awesome -->
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
    />
    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Arvo:wght@400;700&family=Segoe+UI:wght@300;400;600&display=swap"
      rel="stylesheet"
    />
    <style>
      :root {
        --secret: #9b59b6;
        --secondary: #3498db;
        --danger: #e74c3c;
        --success: #27ae60;
        --warning: #f39c12;
      }
      /* Body & General */
      body {
        background: #f8f9fa;
        min-height: 100vh;
        font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
        position: relative;
        overflow-x: hidden;
      }

      /* Fix layout for scrolling */
      html, body {
        overflow-x: hidden;
        width: 100%;
        position: relative;
      }

      /* Container wrapper for fixed layout */
      .content-wrapper {
        width: 100%;
        position: relative;
        overflow: hidden;
      }

      /* 404 Error Page */
      .page_404 {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
        z-index: 9999;
        padding: 40px 0;
        overflow: hidden;
        font-family: "Arvo", serif;
        opacity: 0;
        animation: fadeIn 0.5s forwards;
      }

      @keyframes fadeIn {
        from {
          opacity: 0;
        }
        to {
          opacity: 1;
        }
      }

      .page_404 .container {
        display: flex;
        align-items: center;
        justify-content: center;
        min-height: 100vh;
      }

      .four_zero_four_text {
        text-align: center;
        margin-bottom: 20px;
        animation: slideDown 0.8s ease-out 0.3s both;
      }

      @keyframes slideDown {
        from {
          opacity: 0;
          transform: translateY(-50px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }

      .four_zero_four_text h1 {
        font-family: "Arvo", serif;
        font-size: 80px;
        font-weight: bold;
        color: #fff;
        margin: 0;
        text-shadow: 0 0 20px rgba(231, 76, 60, 0.5);
        position: relative;
        animation: pulse 2s infinite alternate;
      }

      @keyframes pulse {
        0% {
          text-shadow: 0 0 20px rgba(231, 76, 60, 0.5);
          transform: scale(1);
        }
        100% {
          text-shadow: 0 0 30px rgba(231, 76, 60, 0.8);
          transform: scale(1.05);
        }
      }

      .four_zero_four_bg {
        height: 300px;
        position: relative;
        margin-bottom: 30px;
        animation: float 6s ease-in-out infinite;
      }

      @keyframes float {
        0%,
        100% {
          transform: translateY(0);
        }
        50% {
          transform: translateY(-20px);
        }
      }

      .offline-icon {
        font-size: 150px;
        color: rgba(231, 76, 60, 0.7);
        position: relative;
        z-index: 1;
        animation: spin 15s linear infinite;
      }

      @keyframes spin {
        0% {
          transform: rotate(0deg);
        }
        100% {
          transform: rotate(360deg);
        }
      }

      .offline-icon:before {
        content: "";
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        width: 180px;
        height: 180px;
        background: radial-gradient(
          circle,
          rgba(231, 76, 60, 0.2) 0%,
          transparent 70%
        );
        border-radius: 50%;
        z-index: -1;
      }

      .wifi-signal {
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        width: 200px;
        height: 200px;
        z-index: 2;
      }

      .signal {
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        border: 3px solid rgba(231, 76, 60, 0.3);
        border-radius: 50%;
        animation: ripple 2s linear infinite;
      }

      .signal:nth-child(1) {
        width: 60px;
        height: 60px;
        animation-delay: 0s;
      }

      .signal:nth-child(2) {
        width: 100px;
        height: 100px;
        animation-delay: 0.3s;
      }

      .signal:nth-child(3) {
        width: 140px;
        height: 140px;
        animation-delay: 0.6s;
      }

      @keyframes ripple {
        0% {
          transform: translate(-50%, -50%) scale(0.8);
          opacity: 1;
        }
        100% {
          transform: translate(-50%, -50%) scale(1.5);
          opacity: 0;
        }
      }

      .contant_box_404 {
        text-align: center;
        margin-top: -30px;
        animation: slideUp 0.8s ease-out 0.6s both;
      }

      @keyframes slideUp {
        from {
          opacity: 0;
          transform: translateY(50px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }

      .contant_box_404 h3 {
        font-family: "Arvo", serif;
        font-size: 28px;
        margin-bottom: 15px;
        color: #fff;
      }

      .contant_box_404 p {
        font-size: 18px;
        color: rgba(255, 255, 255, 0.8);
        margin-bottom: 25px;
        line-height: 1.5;
        max-width: 600px;
        margin-left: auto;
        margin-right: auto;
      }

      .link_404 {
        color: #fff !important;
        padding: 12px 30px;
        background: #e74c3c;
        margin: 20px 10px;
        display: inline-block;
        border-radius: 50px;
        text-decoration: none;
        font-weight: 600;
        transition: all 0.3s;
        font-size: 16px;
        border: none;
        cursor: pointer;
        box-shadow: 0 4px 15px rgba(231, 76, 60, 0.3);
        position: relative;
        overflow: hidden;
        animation: bounce 2s infinite;
      }

      @keyframes bounce {
        0%,
        100% {
          transform: translateY(0);
        }
        50% {
          transform: translateY(-5px);
        }
      }

      .link_404:before {
        content: "";
        position: absolute;
        top: 0;
        left: -100%;
        width: 100%;
        height: 100%;
        background: linear-gradient(
          90deg,
          transparent,
          rgba(255, 255, 255, 0.2),
          transparent
        );
        transition: 0.5s;
      }

      .link_404:hover:before {
        left: 100%;
      }

      .link_404:hover {
        background: #c0392b;
        color: #fff !important;
        text-decoration: none;
        transform: translateY(-2px);
        box-shadow: 0 6px 20px rgba(231, 76, 60, 0.4);
      }

      /* Tombol alternatif */
      .btn-alt {
        background: var(--secondary) !important;
        box-shadow: 0 4px 15px rgba(52, 152, 219, 0.3);
      }

      .btn-alt:hover {
        background: #2980b9 !important;
        box-shadow: 0 6px 20px rgba(52, 152, 219, 0.4);
      }

      /* Offline Indicator */
      .offline-indicator {
        position: fixed;
        top: 20px;
        right: 20px;
        background: linear-gradient(135deg, #e74c3c, #c0392b);
        color: white;
        padding: 12px 20px;
        border-radius: 50px;
        display: none;
        z-index: 1000;
        box-shadow: 0 5px 15px rgba(231, 76, 60, 0.4);
        font-size: 14px;
        animation: slideInRight 0.5s ease-out, pulse 2s infinite 0.5s;
        transform: translateX(100px);
        opacity: 0;
      }

      @keyframes slideInRight {
        to {
          transform: translateX(0);
          opacity: 1;
        }
      }

      @keyframes pulse {
        0%,
        100% {
          box-shadow: 0 5px 15px rgba(231, 76, 60, 0.4);
        }
        50% {
          box-shadow: 0 5px 20px rgba(231, 76, 60, 0.6);
        }
      }

      /* Animasi untuk status online */
      .online-indicator {
        position: fixed;
        top: 20px;
        right: 20px;
        background: linear-gradient(135deg, #27ae60, #229954);
        color: white;
        padding: 12px 20px;
        border-radius: 50px;
        display: none;
        z-index: 1000;
        box-shadow: 0 5px 15px rgba(39, 174, 96, 0.4);
        font-size: 14px;
        animation: slideInRight 0.5s ease-out, successPulse 2s infinite 0.5s;
        transform: translateX(100px);
        opacity: 0;
      }

      @keyframes successPulse {
        0%,
        100% {
          box-shadow: 0 5px 15px rgba(39, 174, 96, 0.4);
        }
        50% {
          box-shadow: 0 5px 20px rgba(39, 174, 96, 0.6);
        }
      }

      /* Login Screen */
      .login-screen {
        display: flex;
        align-items: center;
        justify-content: center;
        min-height: 100vh;
        padding: 20px;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      }

      .login-card {
        background: white;
        border-radius: 15px;
        box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);
        padding: 2.5rem;
        width: 100%;
        max-width: 400px;
      }

      .login-icon {
        color: var(--secret);
        font-size: 3rem;
        margin-bottom: 1rem;
        text-align: center;
      }

      /* Dashboard */
      .dashboard {
        display: none;
        min-height: 100vh;
        width: 100%;
        position: relative;
      }

      .navbar {
        background: white;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        position: sticky;
        top: 0;
        z-index: 100;
        width: 100%;
      }

      .navbar .container {
        max-width: 100%;
        padding-left: 15px;
        padding-right: 15px;
      }

      .hero-section {
        background: linear-gradient(135deg, var(--secret) 0%, #8e44ad 100%);
        color: white;
        padding: 2rem 0;
        margin-bottom: 2rem;
        width: 100%;
      }

      .container {
        max-width: 100%;
        padding-left: 15px;
        padding-right: 15px;
      }

      /* Search Bar */
      .search-container {
        position: relative;
        margin-bottom: 2rem;
        width: 100%;
      }

      .search-input {
        border-radius: 50px;
        padding-left: 45px;
        border: 2px solid #e0e0e0;
        transition: all 0.3s;
        width: 100%;
      }

      .search-input:focus {
        border-color: var(--secret);
        box-shadow: 0 0 0 0.25rem rgba(155, 89, 182, 0.25);
      }

      .search-icon {
        position: absolute;
        left: 15px;
        top: 50%;
        transform: translateY(-50%);
        color: #6c757d;
        z-index: 10;
      }

      /* Category Card */
      .category-card {
        background: white;
        border-radius: 10px;
        box-shadow: 0 3px 15px rgba(0, 0, 0, 0.1);
        margin-bottom: 1.5rem;
        overflow: hidden;
        border: 2px solid var(--secret);
        transition: transform 0.3s;
        width: 100%;
      }

      .category-card:hover {
        transform: translateY(-5px);
      }

      .category-header {
        padding: 1.25rem;
        background: rgba(155, 89, 182, 0.05);
        border-bottom: 1px solid rgba(155, 89, 182, 0.1);
        cursor: pointer;
        transition: background 0.3s;
      }

      .category-header:hover {
        background: rgba(155, 89, 182, 0.1);
      }

      .category-content {
        padding: 1.25rem;
      }

      /* Item Card */
      .item-card {
        background: #f8f9fa;
        border-radius: 8px;
        padding: 1rem;
        margin-bottom: 1rem;
        border-left: 4px solid var(--secondary);
        transition: all 0.3s;
        width: 100%;
      }

      .item-card:hover {
        background: #e9ecef;
      }

      .btn-secret {
        background: var(--secret);
        color: white;
        border: none;
        transition: all 0.3s;
      }

      .btn-secret:hover {
        background: #8e44ad;
        color: white;
        transform: translateY(-2px);
        box-shadow: 0 4px 10px rgba(155, 89, 182, 0.3);
      }

      .floating-btn {
        position: fixed;
        bottom: 2rem;
        right: 2rem;
        width: 60px;
        height: 60px;
        border-radius: 50%;
        background: var(--secret);
        color: white;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 1.5rem;
        box-shadow: 0 5px 20px rgba(155, 89, 182, 0.5);
        transition: all 0.3s;
        z-index: 100;
      }

      .floating-btn:hover {
        background: #8e44ad;
        transform: scale(1.1);
      }

      .floating-buttons {
        position: fixed;
        bottom: 2rem;
        right: 2rem;
        display: flex;
        flex-direction: column;
        gap: 10px;
        z-index: 100;
      }

      .floating-btn-small {
        width: 50px;
        height: 50px;
        border-radius: 50%;
        background: var(--secondary);
        color: white;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 1.2rem;
        box-shadow: 0 5px 15px rgba(52, 152, 219, 0.5);
        transition: all 0.3s;
      }

      .floating-btn-small:hover {
        transform: scale(1.1);
      }

      .stats-card {
        background: white;
        border-radius: 10px;
        padding: 1.25rem;
        box-shadow: 0 3px 10px rgba(0, 0, 0, 0.1);
        margin-bottom: 1rem;
        text-align: center;
        transition: transform 0.3s;
        width: 100%;
      }

      .stats-card:hover {
        transform: translateY(-5px);
      }

      .stats-number {
        font-size: 1.8rem;
        font-weight: bold;
        color: var(--secret);
      }

      .stats-label {
        font-size: 0.9rem;
        color: #6c757d;
      }

      .badge-category {
        background: var(--secret);
        color: white;
        padding: 0.25rem 0.5rem;
        border-radius: 4px;
        font-size: 0.8rem;
      }

      .error-message {
        color: var(--danger);
        font-size: 0.9rem;
        margin-top: 0.5rem;
        display: none;
      }

      .password-field {
        position: relative;
        width: 100%;
      }

      .password-field input {
        padding-right: 40px;
        width: 100%;
      }

      .toggle-password {
        position: absolute;
        right: 10px;
        top: 50%;
        transform: translateY(-50%);
        background: none;
        border: none;
        color: #6c757d;
        cursor: pointer;
      }

      /* Password Generator Button */
      .generate-btn {
        position: absolute;
        right: 40px;
        top: 50%;
        transform: translateY(-50%);
        background: none;
        border: none;
        color: var(--secondary);
        cursor: pointer;
      }

      /* Password Strength Indicator */
      .password-strength {
        height: 5px;
        border-radius: 3px;
        margin-top: 5px;
        transition: all 0.3s;
      }

      .strength-weak {
        background: var(--danger);
        width: 25%;
      }

      .strength-medium {
        background: var(--warning);
        width: 50%;
      }

      .strength-strong {
        background: var(--success);
        width: 75%;
      }

      .strength-very-strong {
        background: var(--success);
        width: 100%;
      }

      /* Loading Overlay */
      .loading-overlay {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.7);
        display: flex;
        align-items: center;
        justify-content: center;
        z-index: 9999;
        display: none;
      }

      .spinner {
        width: 50px;
        height: 50px;
        border: 5px solid #f3f3f3;
        border-top: 5px solid var(--secret);
        border-radius: 50%;
        animation: spin 1s linear infinite;
      }

      @keyframes spin {
        0% { transform: rotate(0deg); }
        100% { transform: rotate(360deg); }
      }

      /* File Upload Styles */
      .file-upload-container {
        border: 2px dashed #dee2e6;
        border-radius: 8px;
        padding: 20px;
        text-align: center;
        background: #f8f9fa;
        cursor: pointer;
        transition: all 0.3s;
      }

      .file-upload-container:hover {
        border-color: var(--secret);
        background: #f0f0f0;
      }

      .file-upload-icon {
        font-size: 2rem;
        color: var(--secret);
        margin-bottom: 10px;
      }

      .file-preview {
        margin-top: 15px;
      }

      .file-item {
        display: flex;
        align-items: center;
        justify-content: space-between;
        background: white;
        border: 1px solid #dee2e6;
        border-radius: 6px;
        padding: 10px;
        margin-bottom: 8px;
      }

      .file-icon {
        color: var(--secondary);
        margin-right: 10px;
      }

      .file-info {
        flex-grow: 1;
        text-align: left;
      }

      .file-name {
        font-weight: 500;
        margin-bottom: 2px;
        word-break: break-all;
      }

      .file-size {
        font-size: 0.8rem;
        color: #6c757d;
      }

      .file-actions {
        display: flex;
        gap: 5px;
      }

      .file-action-btn {
        background: none;
        border: none;
        color: #6c757d;
        cursor: pointer;
        padding: 5px;
        border-radius: 4px;
        transition: all 0.3s;
      }

      .file-action-btn:hover {
        background: #f8f9fa;
        color: var(--danger);
      }

      /* Attachments in view modal */
      .attachments-list {
        display: flex;
        flex-wrap: wrap;
        gap: 10px;
        margin-top: 10px;
      }

      .attachment-item {
        display: flex;
        align-items: center;
        background: #f8f9fa;
        border: 1px solid #dee2e6;
        border-radius: 6px;
        padding: 8px 12px;
        max-width: 100%;
      }

      .attachment-link {
        color: var(--secondary);
        text-decoration: none;
        display: flex;
        align-items: center;
        gap: 8px;
        flex-grow: 1;
      }

      .attachment-link:hover {
        text-decoration: underline;
      }

      /* URL Link in view modal */
      .url-link {
        color: var(--secondary);
        text-decoration: none;
        word-break: break-all;
      }

      .url-link:hover {
        text-decoration: underline;
      }

      /* Responsive */
      @media (max-width: 768px) {
        .four_zero_four_text h1 {
          font-size: 60px;
        }

        .offline-icon {
          font-size: 120px;
        }

        .offline-icon:before {
          width: 150px;
          height: 150px;
        }

        .wifi-signal {
          width: 160px;
          height: 160px;
        }

        .signal:nth-child(3) {
          width: 120px;
          height: 120px;
        }

        .contant_box_404 h3 {
          font-size: 22px;
        }

        .contant_box_404 p {
          font-size: 16px;
        }

        .link_404 {
          display: block;
          margin: 10px auto;
          width: 80%;
          max-width: 250px;
        }

        .login-card {
          padding: 1.5rem;
        }

        .floating-buttons {
          bottom: 1rem;
          right: 1rem;
        }
        
        .floating-btn {
          bottom: 1rem;
          right: 1rem;
        }

        .file-item {
          flex-direction: column;
          align-items: flex-start;
        }

        .file-actions {
          align-self: flex-end;
          margin-top: 8px;
        }
      }

      /* Import/Export Styles */
      .export-import-section {
        background: #f8f9fa;
        border-radius: 10px;
        padding: 1.5rem;
        margin-bottom: 2rem;
      }
    </style>
  </head>
  <body>
    <div class="content-wrapper">
      <!-- Loading Overlay -->
      <div class="loading-overlay" id="loadingOverlay">
        <div class="spinner"></div>
      </div>

      <!-- Offline Indicator -->
      <div class="offline-indicator" id="offlineIndicator">
        <i class="fas fa-wifi-slash me-2"></i>Anda sedang offline
      </div>

      <!-- Online Indicator -->
      <div class="online-indicator" id="onlineIndicator">
        <i class="fas fa-wifi me-2"></i>Koneksi internet pulih
      </div>

      <!-- 404 Error Page (Hidden by default) -->
      <section class="page_404" id="page404">
        <div class="container">
          <div class="row justify-content-center">
            <div class="col-sm-12 text-center">
              <div class="four_zero_four_text">
                <h1><strong>404</strong></h1>
              </div>

              <div class="four_zero_four_bg">
                <div class="offline-icon">
                  <i class="fas fa-wifi-slash"></i>
                </div>
                <div class="wifi-signal">
                  <div class="signal"></div>
                  <div class="signal"></div>
                  <div class="signal"></div>
                </div>
              </div>

              <div class="contant_box_404">
                <h3 class="h2">Sepertinya Anda sedang offline</h3>

                <p>
                  Aplikasi membutuhkan koneksi internet untuk bekerja dengan
                  optimal. Data Anda tetap aman di browser.
                </p>
                <p>
                  Pastikan perangkat Anda terhubung ke internet, lalu coba refresh
                  halaman.
                </p>

                <button class="link_404" onclick="checkConnection()">
                  <i class="fas fa-redo me-2"></i>Coba Lagi
                </button>
                <button class="link_404 btn-alt" onclick="goToDashboard()">
                  <i class="fas fa-home me-2"></i>Ke Dashboard
                </button>
              </div>
            </div>
          </div>
        </div>
      </section>

      <!-- Login Screen -->
      <div class="login-screen" id="loginScreen">
        <div class="login-card">
          <div class="login-icon">
            <i class="fas fa-user-secret"></i>
          </div>

          <h3 class="text-center mb-4">My Secrets</h3>

          <!-- Setup Form (muncul pertama kali) -->
          <div id="setupForm">
            <div class="mb-3">
              <label class="form-label">Buat Username</label>
              <input
                type="text"
                class="form-control"
                id="setupUsername"
                placeholder="Pilih username Anda"
              />
            </div>

            <div class="mb-3">
              <label class="form-label">Buat Password</label>
              <div class="password-field">
                <input
                  type="password"
                  class="form-control"
                  id="setupPassword"
                  placeholder="Minimal 6 karakter"
                />
                <button
                  class="toggle-password"
                  type="button"
                  onclick="toggleSetupPassword()"
                >
                  <i class="fas fa-eye"></i>
                </button>
              </div>
            </div>

            <div class="mb-3">
              <label class="form-label">Konfirmasi Password</label>
              <div class="password-field">
                <input
                  type="password"
                  class="form-control"
                  id="setupConfirmPassword"
                  placeholder="Ketik ulang password"
                />
                <button
                  class="toggle-password"
                  type="button"
                  onclick="toggleSetupConfirmPassword()"
                >
                  <i class="fas fa-eye"></i>
                </button>
              </div>
            </div>

            <button class="btn btn-secret w-100 mb-3" onclick="setupAccount()">
              <i class="fas fa-user-plus me-2"></i> Buat Akun
            </button>
          </div>

          <!-- Login Form (muncul setelah setup) -->
          <div id="loginForm" style="display: none">
            <div class="mb-3">
              <label class="form-label">Username</label>
              <input
                type="text"
                class="form-control"
                id="loginUsername"
                placeholder="Masukkan username"
              />
            </div>

            <div class="mb-3">
              <label class="form-label">Password</label>
              <div class="password-field">
                <input
                  type="password"
                  class="form-control"
                  id="loginPassword"
                  placeholder="Masukkan password"
                />
                <button
                  class="toggle-password"
                  type="button"
                  onclick="toggleLoginPassword()"
                >
                  <i class="fas fa-eye"></i>
                </button>
              </div>
            </div>

            <div id="loginError" class="error-message">
              <i class="fas fa-exclamation-circle me-1"></i>
              Username atau password salah!
            </div>

            <button class="btn btn-secret w-100 mb-3" onclick="login()">
              <i class="fas fa-sign-in-alt me-2"></i> Login
            </button>

            <div class="text-center">
              <small class="text-muted">
                <i class="fas fa-info-circle me-1"></i>
                Data disimpan di browser Anda
              </small>
            </div>
          </div>
        </div>
      </div>

      <!-- Dashboard -->
      <div class="dashboard" id="dashboard">
        <!-- Navbar -->
        <nav class="navbar navbar-expand-lg navbar-light sticky-top">
          <div class="container">
            <a class="navbar-brand fw-bold" href="#">
              <i class="fas fa-user-secret me-2"></i>My Secrets
            </a>
            <div class="navbar-nav ms-auto">
              <div class="nav-item dropdown">
                <a
                  class="nav-link dropdown-toggle"
                  href="#"
                  data-bs-toggle="dropdown"
                >
                  <i class="fas fa-user-circle me-1"></i>
                  <span id="currentUserDisplay">User</span>
                </a>
                <ul class="dropdown-menu">
                  <li>
                    <a class="dropdown-item" href="#" onclick="exportData()">
                      <i class="fas fa-download me-2"></i>Export Data
                    </a>
                  </li>
                  <li>
                    <a class="dropdown-item" href="#" onclick="importData()">
                      <i class="fas fa-upload me-2"></i>Import Data
                    </a>
                  </li>
                  <li><hr class="dropdown-divider" /></li>
                  <li>
                    <a class="dropdown-item text-danger" href="#" onclick="logout()">
                      <i class="fas fa-sign-out-alt me-2"></i>Logout
                    </a>
                  </li>
                </ul>
              </div>
            </div>
          </div>
        </nav>

        <!-- Hero Section -->
        <section class="hero-section">
          <div class="container">
            <h1 class="display-6 fw-bold mb-2">My Secrets</h1>
            <p class="mb-0">
              Selamat datang, <span id="welcomeUser">User</span>!
            </p>
          </div>
        </section>

        <!-- Stats -->
        <section class="container mb-4">
          <div class="row g-3">
            <div class="col-6 col-md-3">
              <div class="stats-card">
                <div class="stats-number" id="totalCategories">0</div>
                <div class="stats-label">Kategori</div>
              </div>
            </div>
            <div class="col-6 col-md-3">
              <div class="stats-card">
                <div class="stats-number" id="totalItems">0</div>
                <div class="stats-label">Total Akun</div>
              </div>
            </div>
            <div class="col-6 col-md-3">
              <div class="stats-card">
                <div class="stats-number" id="socialMediaCount">0</div>
                <div class="stats-label">Media Sosial</div>
              </div>
            </div>
            <div class="col-6 col-md-3">
              <div class="stats-card">
                <div class="stats-number" id="emailCount">0</div>
                <div class="stats-label">Email</div>
              </div>
            </div>
          </div>
        </section>

        <!-- Search Bar -->
        <section class="container mb-4">
          <div class="search-container">
            <i class="fas fa-search search-icon"></i>
            <input
              type="text"
              class="form-control search-input"
              id="searchInput"
              placeholder="Cari akun, kategori, atau username..."
              oninput="searchItems()"
            />
          </div>
        </section>

        <!-- Main Content -->
        <section class="container mb-5">
          <div class="d-flex justify-content-between align-items-center mb-4">
            <h4>Semua Kategori</h4>
            <button
              class="btn btn-secret btn-sm"
              onclick="openAddCategoryModal()"
            >
              <i class="fas fa-plus me-1"></i> Tambah Kategori
            </button>
          </div>

          <div id="categoriesContainer">
            <!-- Kategori akan ditampilkan di sini -->
          </div>

          <div id="emptyState" class="text-center py-5">
            <i class="fas fa-user-secret fa-3x text-muted mb-3"></i>
            <h5 class="text-muted mb-3">Belum Ada Kategori</h5>
            <p class="text-muted mb-4">
              Mulai tambahkan kategori untuk menyimpan akun Anda
            </p>
            <button
              class="btn btn-secret"
              onclick="openAddCategoryModal()"
            >
              <i class="fas fa-plus me-2"></i> Tambah Kategori Pertama
            </button>
          </div>
        </section>

        <!-- Footer -->
        <footer class="bg-light py-3 mt-5">
          <div class="container text-center">
            <small class="text-muted">
              &copy; 2023 My Secrets â€¢ Data disimpan di browser
            </small>
          </div>
        </footer>

        <!-- Floating Buttons -->
        <div class="floating-buttons">
          <button class="floating-btn-small" onclick="openAddItemModal(null)">
            <i class="fas fa-plus"></i>
          </button>
          <button class="floating-btn" onclick="openAddCategoryModal()">
            <i class="fas fa-folder-plus"></i>
          </button>
        </div>
      </div>

      <!-- Add/Edit Category Modal -->
      <div class="modal fade" id="addCategoryModal" tabindex="-1">
        <div class="modal-dialog">
          <div class="modal-content">
            <div class="modal-header">
              <h5 class="modal-title" id="categoryModalTitle">Tambah Kategori</h5>
              <button
                type="button"
                class="btn-close"
                data-bs-dismiss="modal"
              ></button>
            </div>
            <div class="modal-body">
              <input type="hidden" id="editCategoryId" value="" />
              <div class="mb-3">
                <label class="form-label">Nama Kategori</label>
                <input
                  type="text"
                  class="form-control"
                  id="categoryName"
                  placeholder="Contoh: Media Sosial, Email, dll"
                />
              </div>
              <div class="mb-3">
                <label class="form-label">Deskripsi (opsional)</label>
                <textarea
                  class="form-control"
                  id="categoryDescription"
                  rows="2"
                ></textarea>
              </div>
            </div>
            <div class="modal-footer">
              <button
                type="button"
                class="btn btn-secondary"
                data-bs-dismiss="modal"
              >
                Batal
              </button>
              <button
                type="button"
                class="btn btn-secret"
                id="saveCategoryBtn"
                onclick="saveCategory()"
              >
                Simpan
              </button>
            </div>
          </div>
        </div>
      </div>

      <!-- Add/Edit Item Modal -->
      <div class="modal fade" id="addItemModal" tabindex="-1">
        <div class="modal-dialog modal-lg">
          <div class="modal-content">
            <div class="modal-header">
              <h5 class="modal-title" id="itemModalTitle">Tambah Akun</h5>
              <button
                type="button"
                class="btn-close"
                data-bs-dismiss="modal"
              ></button>
            </div>
            <div class="modal-body">
              <input type="hidden" id="editItemId" value="" />
              <input type="hidden" id="editCategoryIdItem" value="" />
              
              <div class="row">
                <div class="col-md-6">
                  <div class="mb-3">
                    <label class="form-label">Kategori *</label>
                    <select class="form-select" id="itemCategory">
                      <option value="">Pilih Kategori</option>
                    </select>
                  </div>
                </div>
                <div class="col-md-6">
                  <div class="mb-3">
                    <label class="form-label">Nama Akun *</label>
                    <input
                      type="text"
                      class="form-control"
                      id="itemName"
                      placeholder="Contoh: Instagram, Facebook, dll"
                    />
                  </div>
                </div>
              </div>

              <div class="row">
                <div class="col-md-6">
                  <div class="mb-3">
                    <label class="form-label">Username/Email *</label>
                    <input
                      type="text"
                      class="form-control"
                      id="itemUsername"
                      placeholder="username@email.com"
                    />
                  </div>
                </div>
                <div class="col-md-6">
                  <div class="mb-3">
                    <label class="form-label">Password *</label>
                    <div class="password-field">
                      <input
                        type="password"
                        class="form-control"
                        id="itemPassword"
                        placeholder="Password"
                      />
                      <button
                        class="generate-btn"
                        type="button"
                        onclick="generatePassword()"
                      >
                        <i class="fas fa-random"></i>
                      </button>
                      <button
                        class="toggle-password"
                        type="button"
                        onclick="toggleItemPassword()"
                      >
                        <i class="fas fa-eye"></i>
                      </button>
                    </div>
                    <div class="password-strength" id="itemPasswordStrength"></div>
                  </div>
                </div>
              </div>

              <div class="mb-3">
                <label class="form-label">URL Website (opsional)</label>
                <input
                  type="url"
                  class="form-control"
                  id="itemUrl"
                  placeholder="https://example.com"
                />
              </div>

              <div class="mb-3">
                <label class="form-label">Upload File (opsional)</label>
                <div class="file-upload-container" onclick="document.getElementById('fileUpload').click()">
                  <div class="file-upload-icon">
                    <i class="fas fa-cloud-upload-alt"></i>
                  </div>
                  <p class="mb-1">Klik atau drag file ke sini</p>
                  <p class="text-muted small mb-0">Maksimal 5MB per file</p>
                  <input
                    type="file"
                    id="fileUpload"
                    multiple
                    style="display: none;"
                    onchange="handleFileUpload(event)"
                  />
                </div>
                <div id="filePreview" class="file-preview"></div>
              </div>

              <div class="mb-3">
                <label class="form-label">Catatan (opsional)</label>
                <textarea
                  class="form-control"
                  id="itemNotes"
                  rows="3"
                ></textarea>
              </div>
            </div>
            <div class="modal-footer">
              <button
                type="button"
                class="btn btn-secondary"
                data-bs-dismiss="modal"
              >
                Batal
              </button>
              <button type="button" class="btn btn-secret" id="saveItemBtn" onclick="saveItem()">
                Simpan
              </button>
            </div>
          </div>
        </div>
      </div>

      <!-- View Item Modal -->
      <div class="modal fade" id="viewItemModal" tabindex="-1">
        <div class="modal-dialog modal-lg">
          <div class="modal-content">
            <div class="modal-header">
              <h5 class="modal-title" id="viewItemTitle">Detail Akun</h5>
              <button
                type="button"
                class="btn-close"
                data-bs-dismiss="modal"
              ></button>
            </div>
            <div class="modal-body">
              <div class="row">
                <div class="col-md-6">
                  <div class="mb-3">
                    <strong>Kategori:</strong>
                    <div class="mt-1" id="viewItemCategory"></div>
                  </div>
                </div>
                <div class="col-md-6">
                  <div class="mb-3">
                    <strong>Username:</strong>
                    <div class="mt-1" id="viewItemUsername"></div>
                  </div>
                </div>
              </div>

              <div class="mb-3">
                <strong>Password:</strong>
                <div class="password-field mt-1">
                  <input
                    type="password"
                    class="form-control"
                    id="viewItemPassword"
                    readonly
                  />
                  <button
                    class="toggle-password"
                    type="button"
                    onclick="toggleViewPassword()"
                  >
                    <i class="fas fa-eye"></i>
                  </button>
                  <button
                    class="btn btn-outline-secondary btn-sm ms-2"
                    type="button"
                    onclick="copyPassword()"
                  >
                    <i class="fas fa-copy"></i> Salin
                  </button>
                </div>
              </div>

              <div class="mb-3" id="viewItemUrlContainer">
                <strong>URL Website:</strong>
                <div class="mt-1" id="viewItemUrl"></div>
              </div>

              <div class="mb-3" id="viewItemAttachmentsContainer">
                <strong>File Lampiran:</strong>
                <div class="attachments-list" id="viewItemAttachments"></div>
              </div>

              <div class="mb-3" id="viewItemNotesContainer">
                <strong>Catatan:</strong>
                <div class="mt-1" id="viewItemNotes"></div>
              </div>

              <div class="row">
                <div class="col-md-6">
                  <div class="mb-3">
                    <strong>Dibuat:</strong>
                    <div class="mt-1" id="viewItemCreated"></div>
                  </div>
                </div>
                <div class="col-md-6">
                  <div class="mb-3">
                    <strong>Diupdate:</strong>
                    <div class="mt-1" id="viewItemUpdated"></div>
                  </div>
                </div>
              </div>
            </div>
            <div class="modal-footer">
              <button
                type="button"
                class="btn btn-secondary"
                data-bs-dismiss="modal"
              >
                Tutup
              </button>
              <button
                type="button"
                class="btn btn-warning"
                onclick="editCurrentItem()"
              >
                <i class="fas fa-edit me-1"></i>Edit
              </button>
              <button
                type="button"
                class="btn btn-danger"
                onclick="deleteCurrentItem()"
              >
                <i class="fas fa-trash me-1"></i>Hapus
              </button>
            </div>
          </div>
        </div>
      </div>

      <!-- Import Modal -->
      <div class="modal fade" id="importModal" tabindex="-1">
        <div class="modal-dialog">
          <div class="modal-content">
            <div class="modal-header">
              <h5 class="modal-title">Import Data</h5>
              <button
                type="button"
                class="btn-close"
                data-bs-dismiss="modal"
              ></button>
            </div>
            <div class="modal-body">
              <div class="alert alert-warning">
                <i class="fas fa-exclamation-triangle me-2"></i>
                <strong>Peringatan:</strong> Import data akan menimpa semua data yang ada. Backup data Anda terlebih dahulu!
              </div>
              <div class="mb-3">
                <label class="form-label">Pilih file backup (.json)</label>
                <input
                  type="file"
                  class="form-control"
                  id="importFile"
                  accept=".json"
                />
              </div>
              <div class="mb-3">
                <label class="form-label">Master Password</label>
                <input
                  type="password"
                  class="form-control"
                  id="importPassword"
                  placeholder="Masukkan master password untuk verifikasi"
                />
              </div>
            </div>
            <div class="modal-footer">
              <button
                type="button"
                class="btn btn-secondary"
                data-bs-dismiss="modal"
              >
                Batal
              </button>
              <button
                type="button"
                class="btn btn-primary"
                onclick="processImport()"
              >
                Import Data
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
      // Data storage
      let categories = [];
      let currentItemId = null;
      let currentCategoryId = null;
      let currentUser = null;
      let isOnline = navigator.onLine;
      let onlineIndicatorTimeout = null;
      let currentEditingCategoryId = null;
      let currentEditingItemId = null;
      let currentUploadedFiles = []; // Untuk menyimpan file yang diupload sementara

      // Initialize
      document.addEventListener("DOMContentLoaded", function () {
        // Check connection status
        checkConnection();

        // Set up online/offline event listeners
        window.addEventListener("online", handleOnlineStatus);
        window.addEventListener("offline", handleOnlineStatus);

        // Check if account exists
        checkIfAccountExists();
        
        // Setup event listeners for password strength
        document.getElementById('setupPassword')?.addEventListener('input', checkPasswordStrengthSetup);
        document.getElementById('itemPassword')?.addEventListener('input', checkPasswordStrengthItem);
      });

      // Handle online/offline status
      function handleOnlineStatus() {
        isOnline = navigator.onLine;

        if (isOnline) {
          // Online - hide 404 page
          document.getElementById("page404").style.display = "none";
          document.getElementById("offlineIndicator").style.display = "none";

          // Show online indicator
          showOnlineIndicator();

          // Show appropriate screen
          if (currentUser) {
            document.getElementById("dashboard").style.display = "block";
          } else {
            document.getElementById("loginScreen").style.display = "flex";
          }
        } else {
          // Offline - show 404 page
          document.getElementById("page404").style.display = "block";
          document.getElementById("offlineIndicator").style.display = "block";

          // Hide other screens
          document.getElementById("loginScreen").style.display = "none";
          document.getElementById("dashboard").style.display = "none";

          // Hide online indicator if visible
          document.getElementById("onlineIndicator").style.display = "none";
        }
      }

      // Show online indicator
      function showOnlineIndicator() {
        const onlineIndicator = document.getElementById("onlineIndicator");
        onlineIndicator.style.display = "block";

        // Auto-hide after 3 seconds
        clearTimeout(onlineIndicatorTimeout);
        onlineIndicatorTimeout = setTimeout(() => {
          onlineIndicator.style.display = "none";
        }, 3000);
      }

      // Check connection manually
      function checkConnection() {
        if (navigator.onLine) {
          // Online
          handleOnlineStatus();

          // If we were on the 404 page, show success message
          if (document.getElementById("page404").style.display === "block") {
            alert("Koneksi internet telah pulih! Aplikasi siap digunakan.");
          }
        } else {
          // Offline
          handleOnlineStatus();
        }
      }

      // Go to dashboard (from 404 page)
      function goToDashboard() {
        if (isOnline) {
          document.getElementById("page404").style.display = "none";

          if (currentUser) {
            document.getElementById("dashboard").style.display = "block";
          } else {
            document.getElementById("loginScreen").style.display = "flex";
          }
        } else {
          alert("Anda masih offline. Silakan cek koneksi internet Anda.");
        }
      }

      // Check if account exists in localStorage
      function checkIfAccountExists() {
        const savedUser = localStorage.getItem("secretManagerUser");
        const savedPass = localStorage.getItem("secretManagerPass");

        if (savedUser && savedPass) {
          // Account exists, show login form
          document.getElementById("setupForm").style.display = "none";
          document.getElementById("loginForm").style.display = "block";

          // Auto-fill username
          document.getElementById("loginUsername").value = savedUser;
        } else {
          // No account, show setup form
          document.getElementById("setupForm").style.display = "block";
          document.getElementById("loginForm").style.display = "none";
        }
      }

      // Toggle password visibility functions
      function toggleSetupPassword() {
        const input = document.getElementById("setupPassword");
        const icon = event.target.closest("button").querySelector("i");
        togglePasswordVisibility(input, icon);
      }

      function toggleSetupConfirmPassword() {
        const input = document.getElementById("setupConfirmPassword");
        const icon = event.target.closest("button").querySelector("i");
        togglePasswordVisibility(input, icon);
      }

      function toggleLoginPassword() {
        const input = document.getElementById("loginPassword");
        const icon = event.target.closest("button").querySelector("i");
        togglePasswordVisibility(input, icon);
      }

      function toggleItemPassword() {
        const input = document.getElementById("itemPassword");
        const icon = event.target.closest("button").querySelector("i");
        togglePasswordVisibility(input, icon);
      }

      function toggleViewPassword() {
        const input = document.getElementById("viewItemPassword");
        const icon = event.target.closest("button").querySelector("i");
        togglePasswordVisibility(input, icon);
      }

      function togglePasswordVisibility(input, icon) {
        if (input.type === "password") {
          input.type = "text";
          icon.className = "fas fa-eye-slash";
        } else {
          input.type = "password";
          icon.className = "fas fa-eye";
        }
      }

      // Check password strength
      function checkPasswordStrength(password) {
        let strength = 0;
        
        if (password.length >= 8) strength++;
        if (/[a-z]/.test(password)) strength++;
        if (/[A-Z]/.test(password)) strength++;
        if (/[0-9]/.test(password)) strength++;
        if (/[^A-Za-z0-9]/.test(password)) strength++;
        
        return strength;
      }

      function checkPasswordStrengthSetup() {
        const password = document.getElementById("setupPassword").value;
        const strengthBar = document.getElementById("setupPasswordStrength");
        if (strengthBar) updatePasswordStrength(strengthBar, password);
      }
      
      function checkPasswordStrengthItem() {
        const password = document.getElementById("itemPassword").value;
        const strengthBar = document.getElementById("itemPasswordStrength");
        if (strengthBar) updatePasswordStrength(strengthBar, password);
      }
      
      function updatePasswordStrength(element, password) {
        const strength = checkPasswordStrength(password);
        element.className = "password-strength";
        
        if (password.length === 0) {
          element.style.width = "0%";
          return;
        }
        
        if (strength <= 2) {
          element.classList.add("strength-weak");
        } else if (strength === 3) {
          element.classList.add("strength-medium");
        } else if (strength === 4) {
          element.classList.add("strength-strong");
        } else {
          element.classList.add("strength-very-strong");
        }
      }

      // Generate random password
      function generatePassword() {
        const chars = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789!@#$%^&*()_+-=[]{}|;:,.<>?';
        let password = '';
        const length = 12;
        
        // Ensure at least one of each type
        password += 'ABCDEFGHIJKLMNOPQRSTUVWXYZ'[Math.floor(Math.random() * 26)];
        password += 'abcdefghijklmnopqrstuvwxyz'[Math.floor(Math.random() * 26)];
        password += '0123456789'[Math.floor(Math.random() * 10)];
        password += '!@#$%^&*()_+-=[]{}|;:,.<>?'[Math.floor(Math.random() * 30)];
        
        // Fill the rest
        for (let i = 4; i < length; i++) {
          password += chars[Math.floor(Math.random() * chars.length)];
        }
        
        // Shuffle the password
        password = password.split('').sort(() => Math.random() - 0.5).join('');
        
        document.getElementById("itemPassword").value = password;
        checkPasswordStrengthItem();
      }

      // Setup new account
      function setupAccount() {
        if (!isOnline) {
          alert("Anda harus online untuk membuat akun pertama kali.");
          return;
        }

        const username = document.getElementById("setupUsername").value.trim();
        const password = document.getElementById("setupPassword").value;
        const confirmPassword = document.getElementById(
          "setupConfirmPassword"
        ).value;

        // Validation
        if (!username || username.length < 3) {
          alert("Username minimal 3 karakter!");
          return;
        }

        if (!password || password.length < 6) {
          alert("Password minimal 6 karakter!");
          return;
        }

        if (password !== confirmPassword) {
          alert("Password tidak cocok!");
          return;
        }

        // Save to localStorage
        localStorage.setItem("secretManagerUser", username);
        localStorage.setItem("secretManagerPass", password);

        // Set current user
        currentUser = username;

        // Switch to login form
        document.getElementById("setupForm").style.display = "none";
        document.getElementById("loginForm").style.display = "block";

        // Auto-fill login form
        document.getElementById("loginUsername").value = username;

        alert("Akun berhasil dibuat! Silakan login.");
      }

      // Login function
      function login() {
        const username = document.getElementById("loginUsername").value.trim();
        const password = document.getElementById("loginPassword").value;

        // Get saved credentials
        const savedUser = localStorage.getItem("secretManagerUser");
        const savedPass = localStorage.getItem("secretManagerPass");

        // Check credentials
        if (username === savedUser && password === savedPass) {
          // Login success
          currentUser = username;
          showDashboard();
        } else {
          // Login failed
          document.getElementById("loginError").style.display = "block";
          setTimeout(() => {
            document.getElementById("loginError").style.display = "none";
          }, 3000);
        }
      }

      // Show dashboard
      function showDashboard() {
        // Check if online
        if (!isOnline) {
          alert("Anda sedang offline. Beberapa fitur mungkin terbatas.");
        }

        // Load categories for current user
        loadUserCategories();

        // Update UI
        document.getElementById("welcomeUser").textContent = currentUser;
        document.getElementById("currentUserDisplay").textContent = currentUser;

        // Switch screens
        document.getElementById("loginScreen").style.display = "none";
        document.getElementById("dashboard").style.display = "block";

        // Render categories
        renderCategories();
        updateStats();
        populateCategorySelect();
      }

      // Load categories for current user
      function loadUserCategories() {
        const userCategories = localStorage.getItem(
          `secretCategories_${currentUser}`
        );
        categories = userCategories ? JSON.parse(userCategories) : [];
        
        // Konversi data lama (tanpa attachments) untuk kompatibilitas
        categories.forEach(category => {
          category.items = category.items.map(item => {
            if (!item.attachments) {
              item.attachments = [];
            }
            if (!item.updatedAt) {
              item.updatedAt = item.createdAt;
            }
            return item;
          });
        });
      }

      // Save categories for current user
      function saveUserCategories() {
        localStorage.setItem(
          `secretCategories_${currentUser}`,
          JSON.stringify(categories)
        );
      }

      // Logout
      function logout() {
        if (confirm("Apakah Anda yakin ingin logout?")) {
          currentUser = null;
          document.getElementById("loginScreen").style.display = "flex";
          document.getElementById("dashboard").style.display = "none";

          // Clear login form
          document.getElementById("loginPassword").value = "";
          // Clear search
          document.getElementById("searchInput").value = "";
        }
      }

      // Populate category select
      function populateCategorySelect() {
        const select = document.getElementById("itemCategory");
        if (!select) return;
        
        select.innerHTML = '<option value="">Pilih Kategori</option>';
        
        categories.forEach(category => {
          const option = document.createElement("option");
          option.value = category.id;
          option.textContent = category.name;
          select.appendChild(option);
        });
      }

      // Open add category modal (for edit or add)
      function openAddCategoryModal(categoryId = null) {
        currentEditingCategoryId = categoryId;
        const modal = document.getElementById("addCategoryModal");
        const title = document.getElementById("categoryModalTitle");
        const nameInput = document.getElementById("categoryName");
        const descInput = document.getElementById("categoryDescription");
        const saveBtn = document.getElementById("saveCategoryBtn");
        
        if (categoryId) {
          // Edit mode
          const category = categories.find(c => c.id === categoryId);
          if (category) {
            title.textContent = "Edit Kategori";
            nameInput.value = category.name;
            descInput.value = category.description || "";
            saveBtn.textContent = "Update";
            saveBtn.onclick = () => updateCategory();
          }
        } else {
          // Add mode
          title.textContent = "Tambah Kategori";
          nameInput.value = "";
          descInput.value = "";
          saveBtn.textContent = "Simpan";
          saveBtn.onclick = () => saveCategory();
        }
        
        new bootstrap.Modal(modal).show();
      }

      // Save category
      function saveCategory() {
        const name = document.getElementById("categoryName").value.trim();
        const description = document.getElementById("categoryDescription").value.trim();

        if (!name) {
          alert("Nama kategori harus diisi!");
          return;
        }

        const category = {
          id: Date.now(),
          name,
          description,
          items: [],
          createdAt: new Date().toISOString(),
          updatedAt: new Date().toISOString()
        };

        categories.push(category);
        saveUserCategories();
        renderCategories();
        updateStats();
        populateCategorySelect();

        // Reset form and close modal
        document.getElementById("categoryName").value = "";
        document.getElementById("categoryDescription").value = "";
        bootstrap.Modal.getInstance(
          document.getElementById("addCategoryModal")
        ).hide();

        alert("Kategori berhasil ditambahkan!");
      }

      // Update category
      function updateCategory() {
        const name = document.getElementById("categoryName").value.trim();
        const description = document.getElementById("categoryDescription").value.trim();

        if (!name) {
          alert("Nama kategori harus diisi!");
          return;
        }

        const categoryIndex = categories.findIndex(c => c.id === currentEditingCategoryId);
        if (categoryIndex !== -1) {
          categories[categoryIndex].name = name;
          categories[categoryIndex].description = description;
          categories[categoryIndex].updatedAt = new Date().toISOString();
          
          saveUserCategories();
          renderCategories();
          updateStats();
          populateCategorySelect();
          
          bootstrap.Modal.getInstance(document.getElementById("addCategoryModal")).hide();
          alert("Kategori berhasil diperbarui!");
        }
        
        currentEditingCategoryId = null;
      }

      // Handle file upload
      function handleFileUpload(event) {
        const files = event.target.files;
        const previewContainer = document.getElementById("filePreview");
        
        // Reset preview
        previewContainer.innerHTML = "";
        currentUploadedFiles = [];
        
        // Validate files
        for (let i = 0; i < files.length; i++) {
          const file = files[i];
          
          // Check file size (max 5MB)
          if (file.size > 5 * 1024 * 1024) {
            alert(`File "${file.name}" terlalu besar. Maksimal 5MB.`);
            continue;
          }
          
          // Convert file to base64 for storage
          const reader = new FileReader();
          reader.onload = function(e) {
            currentUploadedFiles.push({
              name: file.name,
              type: file.type,
              size: file.size,
              data: e.target.result.split(',')[1], // Remove data URL prefix
              lastModified: file.lastModified
            });
            
            // Add to preview
            const fileItem = document.createElement("div");
            fileItem.className = "file-item";
            
            const fileSize = formatFileSize(file.size);
            const fileIcon = getFileIcon(file.type, file.name);
            
            fileItem.innerHTML = `
              <div class="file-info">
                <div class="file-name">${file.name}</div>
                <div class="file-size">${fileSize}</div>
              </div>
              <div class="file-actions">
                <button class="file-action-btn" onclick="removeFile('${file.name}')" title="Hapus">
                  <i class="fas fa-times"></i>
                </button>
              </div>
            `;
            
            // Insert icon
            const iconSpan = document.createElement("span");
            iconSpan.className = "file-icon";
            iconSpan.innerHTML = `<i class="${fileIcon}"></i>`;
            fileItem.insertBefore(iconSpan, fileItem.firstChild);
            
            previewContainer.appendChild(fileItem);
          };
          
          reader.readAsDataURL(file);
        }
      }

      // Remove file from upload list
      function removeFile(fileName) {
        currentUploadedFiles = currentUploadedFiles.filter(file => file.name !== fileName);
        
        // Update preview
        const previewContainer = document.getElementById("filePreview");
        const fileItems = previewContainer.querySelectorAll('.file-item');
        
        fileItems.forEach(item => {
          const nameElement = item.querySelector('.file-name');
          if (nameElement && nameElement.textContent === fileName) {
            item.remove();
          }
        });
      }

      // Get icon based on file type
      function getFileIcon(fileType, fileName) {
        const extension = fileName.split('.').pop().toLowerCase();
        
        if (fileType.startsWith('image/')) return 'fas fa-image';
        if (fileType.startsWith('video/')) return 'fas fa-video';
        if (fileType.startsWith('audio/')) return 'fas fa-music';
        if (fileType.includes('pdf')) return 'fas fa-file-pdf';
        if (fileType.includes('word') || extension === 'doc' || extension === 'docx') return 'fas fa-file-word';
        if (fileType.includes('excel') || extension === 'xls' || extension === 'xlsx') return 'fas fa-file-excel';
        if (fileType.includes('powerpoint') || extension === 'ppt' || extension === 'pptx') return 'fas fa-file-powerpoint';
        if (extension === 'txt') return 'fas fa-file-alt';
        if (extension === 'zip' || extension === 'rar' || extension === '7z') return 'fas fa-file-archive';
        return 'fas fa-file';
      }

      // Format file size
      function formatFileSize(bytes) {
        if (bytes === 0) return '0 Bytes';
        const k = 1024;
        const sizes = ['Bytes', 'KB', 'MB', 'GB'];
        const i = Math.floor(Math.log(bytes) / Math.log(k));
        return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
      }

      // Open add item modal (for edit or add)
      function openAddItemModal(categoryId = null) {
        currentEditingItemId = null;
        currentUploadedFiles = [];
        const modal = document.getElementById("addItemModal");
        const title = document.getElementById("itemModalTitle");
        const saveBtn = document.getElementById("saveItemBtn");
        
        title.textContent = "Tambah Akun";
        saveBtn.textContent = "Simpan";
        saveBtn.onclick = () => saveItem();
        
        // Reset form
        document.getElementById("editItemId").value = "";
        document.getElementById("itemName").value = "";
        document.getElementById("itemUsername").value = "";
        document.getElementById("itemPassword").value = "";
        document.getElementById("itemUrl").value = "";
        document.getElementById("itemNotes").value = "";
        document.getElementById("itemPasswordStrength").className = "password-strength";
        document.getElementById("filePreview").innerHTML = "";
        document.getElementById("fileUpload").value = "";
        
        // Set category if provided
        if (categoryId) {
          document.getElementById("itemCategory").value = categoryId;
        }
        
        // Populate category select
        populateCategorySelect();
        
        new bootstrap.Modal(modal).show();
      }

      // Save item
      function saveItem() {
        const categoryId = parseInt(document.getElementById("itemCategory").value);
        const name = document.getElementById("itemName").value.trim();
        const username = document.getElementById("itemUsername").value.trim();
        const password = document.getElementById("itemPassword").value;
        const url = document.getElementById("itemUrl").value.trim();
        const notes = document.getElementById("itemNotes").value.trim();

        if (!categoryId) {
          alert("Pilih kategori terlebih dahulu!");
          return;
        }

        if (!name || !username || !password) {
          alert("Nama, username, dan password harus diisi!");
          return;
        }

        const category = categories.find((c) => c.id === categoryId);
        if (!category) return;

        const item = {
          id: Date.now(),
          name,
          username,
          password,
          url,
          notes,
          attachments: [...currentUploadedFiles], // Save uploaded files
          createdAt: new Date().toISOString(),
          updatedAt: new Date().toISOString()
        };

        category.items.push(item);
        saveUserCategories();
        renderCategories();
        updateStats();

        // Reset form and close modal
        document.getElementById("itemName").value = "";
        document.getElementById("itemUsername").value = "";
        document.getElementById("itemPassword").value = "";
        document.getElementById("itemUrl").value = "";
        document.getElementById("itemNotes").value = "";
        document.getElementById("filePreview").innerHTML = "";
        document.getElementById("fileUpload").value = "";
        currentUploadedFiles = [];
        
        bootstrap.Modal.getInstance(
          document.getElementById("addItemModal")
        ).hide();

        alert("Akun berhasil ditambahkan!");
      }

      // Delete category
      function deleteCategory(id) {
        if (
          !confirm(
            "Hapus kategori ini? Semua akun di dalamnya juga akan terhapus!"
          )
        )
          return;

        categories = categories.filter((c) => c.id !== id);
        saveUserCategories();
        renderCategories();
        updateStats();
        populateCategorySelect();
        alert("Kategori berhasil dihapus!");
      }

      // Delete item
      function deleteItem(categoryId, itemId) {
        if (!confirm("Hapus akun ini?")) return;

        const category = categories.find((c) => c.id === categoryId);
        if (category) {
          category.items = category.items.filter((i) => i.id !== itemId);
          saveUserCategories();
          renderCategories();
          updateStats();
          alert("Akun berhasil dihapus!");
        }
      }

      // Toggle category content
      function toggleCategory(id) {
        const content = document.getElementById(`category-content-${id}`);
        const icon = document.getElementById(`category-icon-${id}`);

        if (content.style.display === "none") {
          content.style.display = "block";
          icon.className = "fas fa-chevron-up";
        } else {
          content.style.display = "none";
          icon.className = "fas fa-chevron-down";
        }
      }

      // View item details
      function viewItem(categoryId, itemId) {
        const category = categories.find((c) => c.id === categoryId);
        if (!category) return;

        const item = category.items.find((i) => i.id === itemId);
        if (!item) return;

        currentItemId = itemId;
        currentCategoryId = categoryId;

        // Populate modal
        document.getElementById("viewItemTitle").textContent = item.name;
        document.getElementById("viewItemCategory").textContent = category.name;
        document.getElementById("viewItemUsername").textContent = item.username;
        document.getElementById("viewItemPassword").value = item.password;
        document.getElementById("viewItemCreated").textContent = new Date(item.createdAt).toLocaleString();
        document.getElementById("viewItemUpdated").textContent = new Date(item.updatedAt).toLocaleString();
        
        if (item.url) {
          document.getElementById("viewItemUrlContainer").style.display = "block";
          document.getElementById("viewItemUrl").innerHTML = `<a href="${item.url}" target="_blank" class="url-link">${item.url}</a>`;
        } else {
          document.getElementById("viewItemUrlContainer").style.display = "none";
        }

        // Show attachments if any
        if (item.attachments && item.attachments.length > 0) {
          const attachmentsContainer = document.getElementById("viewItemAttachmentsContainer");
          const attachmentsList = document.getElementById("viewItemAttachments");
          
          attachmentsContainer.style.display = "block";
          attachmentsList.innerHTML = "";
          
          item.attachments.forEach((file, index) => {
            const fileIcon = getFileIcon(file.type, file.name);
            const fileSize = formatFileSize(file.size);
            
            const attachmentItem = document.createElement("div");
            attachmentItem.className = "attachment-item";
            attachmentItem.innerHTML = `
              <a href="data:${file.type};base64,${file.data}" download="${file.name}" class="attachment-link">
                <i class="${fileIcon}"></i>
                <span>${file.name} (${fileSize})</span>
              </a>
              <button class="file-action-btn" onclick="downloadAttachment('${file.name}', '${file.type}', '${file.data}')" title="Download">
                <i class="fas fa-download"></i>
              </button>
            `;
            
            attachmentsList.appendChild(attachmentItem);
          });
        } else {
          document.getElementById("viewItemAttachmentsContainer").style.display = "none";
        }

        if (item.notes) {
          document.getElementById("viewItemNotesContainer").style.display = "block";
          document.getElementById("viewItemNotes").textContent = item.notes;
        } else {
          document.getElementById("viewItemNotesContainer").style.display = "none";
        }

        // Show modal
        new bootstrap.Modal(document.getElementById("viewItemModal")).show();
      }

      // Download attachment
      function downloadAttachment(fileName, fileType, base64Data) {
        try {
          const byteCharacters = atob(base64Data);
          const byteNumbers = new Array(byteCharacters.length);
          for (let i = 0; i < byteCharacters.length; i++) {
            byteNumbers[i] = byteCharacters.charCodeAt(i);
          }
          const byteArray = new Uint8Array(byteNumbers);
          const blob = new Blob([byteArray], { type: fileType });
          
          const url = window.URL.createObjectURL(blob);
          const a = document.createElement('a');
          a.href = url;
          a.download = fileName;
          document.body.appendChild(a);
          a.click();
          window.URL.revokeObjectURL(url);
          document.body.removeChild(a);
        } catch (error) {
          console.error('Error downloading file:', error);
          alert('Gagal mendownload file. File mungkin rusak.');
        }
      }

      // Edit current item
      function editCurrentItem() {
        if (!currentCategoryId || !currentItemId) return;

        const category = categories.find((c) => c.id === currentCategoryId);
        if (!category) return;

        const item = category.items.find((i) => i.id === currentItemId);
        if (!item) return;

        currentEditingItemId = currentItemId;
        currentUploadedFiles = item.attachments || [];
        
        // Populate form
        const modal = document.getElementById("addItemModal");
        const title = document.getElementById("itemModalTitle");
        const saveBtn = document.getElementById("saveItemBtn");
        
        title.textContent = "Edit Akun";
        saveBtn.textContent = "Update";
        saveBtn.onclick = () => updateItem();
        
        document.getElementById("editItemId").value = item.id;
        document.getElementById("itemCategory").value = currentCategoryId;
        document.getElementById("itemName").value = item.name;
        document.getElementById("itemUsername").value = item.username;
        document.getElementById("itemPassword").value = item.password;
        document.getElementById("itemUrl").value = item.url || "";
        document.getElementById("itemNotes").value = item.notes || "";
        
        // Show existing attachments
        const previewContainer = document.getElementById("filePreview");
        previewContainer.innerHTML = "";
        
        if (item.attachments && item.attachments.length > 0) {
          item.attachments.forEach(file => {
            const fileItem = document.createElement("div");
            fileItem.className = "file-item";
            
            const fileSize = formatFileSize(file.size);
            const fileIcon = getFileIcon(file.type, file.name);
            
            fileItem.innerHTML = `
              <div class="file-info">
                <div class="file-name">${file.name}</div>
                <div class="file-size">${fileSize}</div>
              </div>
              <div class="file-actions">
                <button class="file-action-btn" onclick="removeFile('${file.name}')" title="Hapus">
                  <i class="fas fa-times"></i>
                </button>
              </div>
            `;
            
            // Insert icon
            const iconSpan = document.createElement("span");
            iconSpan.className = "file-icon";
            iconSpan.innerHTML = `<i class="${fileIcon}"></i>`;
            fileItem.insertBefore(iconSpan, fileItem.firstChild);
            
            previewContainer.appendChild(fileItem);
          });
        }
        
        checkPasswordStrengthItem();
        populateCategorySelect();
        
        // Close view modal and open edit modal
        bootstrap.Modal.getInstance(
          document.getElementById("viewItemModal")
        ).hide();
        new bootstrap.Modal(modal).show();
      }

      // Update item
      function updateItem() {
        const categoryId = parseInt(document.getElementById("itemCategory").value);
        const name = document.getElementById("itemName").value.trim();
        const username = document.getElementById("itemUsername").value.trim();
        const password = document.getElementById("itemPassword").value;
        const url = document.getElementById("itemUrl").value.trim();
        const notes = document.getElementById("itemNotes").value.trim();

        if (!categoryId || !name || !username || !password) {
          alert("Nama, username, dan password harus diisi!");
          return;
        }

        const category = categories.find((c) => c.id === categoryId);
        if (!category) return;

        const itemIndex = category.items.findIndex(
          (i) => i.id === currentEditingItemId
        );
        if (itemIndex === -1) return;

        category.items[itemIndex] = {
          ...category.items[itemIndex],
          name,
          username,
          password,
          url,
          notes,
          attachments: [...currentUploadedFiles], // Update attachments
          updatedAt: new Date().toISOString(),
        };

        saveUserCategories();
        renderCategories();
        updateStats();
        populateCategorySelect();

        // Reset
        document.getElementById("itemName").value = "";
        document.getElementById("itemUsername").value = "";
        document.getElementById("itemPassword").value = "";
        document.getElementById("itemUrl").value = "";
        document.getElementById("itemNotes").value = "";
        document.getElementById("filePreview").innerHTML = "";
        document.getElementById("fileUpload").value = "";
        
        const saveBtn = document.getElementById("saveItemBtn");
        saveBtn.textContent = "Simpan";
        saveBtn.onclick = saveItem;

        currentItemId = null;
        currentCategoryId = null;
        currentEditingItemId = null;
        currentUploadedFiles = [];

        // Close modal
        bootstrap.Modal.getInstance(
          document.getElementById("addItemModal")
        ).hide();

        alert("Akun berhasil diperbarui!");
      }

      // Delete current item
      function deleteCurrentItem() {
        if (!currentCategoryId || !currentItemId) return;

        if (!confirm("Hapus akun ini?")) return;

        const category = categories.find((c) => c.id === currentCategoryId);
        if (category) {
          category.items = category.items.filter((i) => i.id !== currentItemId);
          saveUserCategories();
          renderCategories();
          updateStats();

          bootstrap.Modal.getInstance(
            document.getElementById("viewItemModal")
          ).hide();
          currentItemId = null;
          currentCategoryId = null;

          alert("Akun berhasil dihapus!");
        }
      }

      // Copy password to clipboard
      function copyPassword() {
        const password = document.getElementById("viewItemPassword").value;
        navigator.clipboard.writeText(password).then(() => {
          alert("Password disalin ke clipboard!");
        });
      }

      // Search items
      function searchItems() {
        const searchTerm = document.getElementById("searchInput").value.toLowerCase().trim();
        const container = document.getElementById("categoriesContainer");
        const emptyState = document.getElementById("emptyState");
        
        if (!searchTerm) {
          renderCategories();
          return;
        }
        
        let hasResults = false;
        let html = '';
        
        categories.forEach(category => {
          const matchingItems = category.items.filter(item =>
            item.name.toLowerCase().includes(searchTerm) ||
            item.username.toLowerCase().includes(searchTerm) ||
            (item.notes && item.notes.toLowerCase().includes(searchTerm)) ||
            category.name.toLowerCase().includes(searchTerm) ||
            (category.description && category.description.toLowerCase().includes(searchTerm))
          );
          
          if (matchingItems.length > 0 || category.name.toLowerCase().includes(searchTerm)) {
            hasResults = true;
            
            // Include all items if category name matches, otherwise only matching items
            const itemsToShow = category.name.toLowerCase().includes(searchTerm) ? category.items : matchingItems;
            
            html += `
              <div class="category-card">
                <div class="category-header" onclick="toggleCategory(${category.id})">
                  <div class="d-flex justify-content-between align-items-center">
                    <div>
                      <h5 class="mb-1">${category.name}</h5>
                      <p class="mb-0 text-muted">
                        <span class="badge-category">${itemsToShow.length} hasil ditemukan</span>
                        ${category.description ? `<span class="ms-2">${category.description}</span>` : ''}
                      </p>
                    </div>
                    <i id="category-icon-${category.id}" class="fas fa-chevron-down"></i>
                  </div>
                </div>
                <div class="category-content" id="category-content-${category.id}" style="display: none;">
                  <div class="d-flex justify-content-end mb-3">
                    <button class="btn btn-sm btn-secret me-2" onclick="openAddItemModal(${category.id})">
                      <i class="fas fa-plus me-1"></i> Tambah Akun
                    </button>
                    <button class="btn btn-sm btn-outline-warning me-2" onclick="openAddCategoryModal(${category.id})">
                      <i class="fas fa-edit"></i>
                    </button>
                    <button class="btn btn-sm btn-outline-danger" onclick="deleteCategory(${category.id})">
                      <i class="fas fa-trash"></i>
                    </button>
                  </div>
                  <div class="items-list">
                    ${itemsToShow.length > 0 ? itemsToShow.map(item => `
                      <div class="item-card">
                        <div class="d-flex justify-content-between align-items-center">
                          <div>
                            <h6 class="mb-1">${item.name}</h6>
                            <small class="text-muted">${item.username}</small>
                          </div>
                          <div>
                            <button class="btn btn-sm btn-outline-primary me-1" onclick="viewItem(${category.id}, ${item.id})">
                              <i class="fas fa-eye"></i>
                            </button>
                            <button class="btn btn-sm btn-outline-danger" onclick="deleteItem(${category.id}, ${item.id})">
                              <i class="fas fa-trash"></i>
                            </button>
                          </div>
                        </div>
                      </div>
                    `).join('') : `
                      <div class="text-center py-3 text-muted">
                        <p>Belum ada akun di kategori ini</p>
                      </div>
                    `}
                  </div>
                </div>
              </div>
            `;
          }
        });
        
        if (hasResults) {
          container.innerHTML = html;
          container.style.display = "block";
          emptyState.style.display = "none";
        } else {
          container.style.display = "none";
          emptyState.style.display = "block";
          emptyState.innerHTML = `
            <div class="text-center py-5">
              <i class="fas fa-search fa-3x text-muted mb-3"></i>
              <h5 class="text-muted mb-3">Tidak ada hasil ditemukan</h5>
              <p class="text-muted">Coba dengan kata kunci lain</p>
            </div>
          `;
        }
      }

      // Render categories
      function renderCategories() {
        const container = document.getElementById("categoriesContainer");
        const emptyState = document.getElementById("emptyState");

        if (categories.length === 0) {
          container.style.display = "none";
          emptyState.style.display = "block";
        } else {
          container.style.display = "block";
          emptyState.style.display = "none";
          container.innerHTML = "";

          categories.forEach((category) => {
            const categoryCard = document.createElement("div");
            categoryCard.className = "category-card";

            categoryCard.innerHTML = `
              <div class="category-header" onclick="toggleCategory(${
                category.id
              })">
                <div class="d-flex justify-content-between align-items-center">
                  <div>
                    <h5 class="mb-1">${category.name}</h5>
                    <p class="mb-0 text-muted">
                      <span class="badge-category">${
                        category.items.length
                      } akun</span>
                      ${
                        category.description
                          ? `<span class="ms-2">${category.description}</span>`
                          : ""
                      }
                    </p>
                  </div>
                  <i id="category-icon-${
                    category.id
                  }" class="fas fa-chevron-down"></i>
                </div>
              </div>
              <div class="category-content" id="category-content-${
                category.id
              }" style="display: none;">
                <div class="d-flex justify-content-end mb-3">
                  <button class="btn btn-sm btn-secret me-2" onclick="openAddItemModal(${
                    category.id
                  })">
                    <i class="fas fa-plus me-1"></i> Tambah Akun
                  </button>
                  <button class="btn btn-sm btn-outline-warning me-2" onclick="openAddCategoryModal(${
                    category.id
                  })">
                    <i class="fas fa-edit"></i>
                  </button>
                  <button class="btn btn-sm btn-outline-danger" onclick="deleteCategory(${
                    category.id
                  })">
                    <i class="fas fa-trash"></i>
                  </button>
                </div>
                
                <div class="items-list">
                  ${
                    category.items.length > 0
                      ? category.items
                          .map(
                            (item) => `
                        <div class="item-card">
                          <div class="d-flex justify-content-between align-items-center">
                            <div>
                              <h6 class="mb-1">${item.name}</h6>
                              <small class="text-muted">${item.username}</small>
                              ${item.attachments && item.attachments.length > 0 ? 
                                `<small class="text-info"><i class="fas fa-paperclip me-1"></i>${item.attachments.length} file</small>` : 
                                ''
                              }
                            </div>
                            <div>
                              <button class="btn btn-sm btn-outline-primary me-1" onclick="viewItem(${category.id}, ${item.id})">
                                <i class="fas fa-eye"></i>
                              </button>
                              <button class="btn btn-sm btn-outline-danger" onclick="deleteItem(${category.id}, ${item.id})">
                                <i class="fas fa-trash"></i>
                              </button>
                            </div>
                          </div>
                        </div>
                      `
                          )
                          .join("")
                      : `
                        <div class="text-center py-3 text-muted">
                          <p>Belum ada akun di kategori ini</p>
                        </div>
                      `
                  }
                </div>
              </div>
            `;

            container.appendChild(categoryCard);
          });
        }
      }

      // Update statistics
      function updateStats() {
        const totalCategories = categories.length;
        let totalItems = 0;
        let socialMediaCount = 0;
        let emailCount = 0;

        categories.forEach((category) => {
          totalItems += category.items.length;

          const lowerName = category.name.toLowerCase();
          if (
            lowerName.includes("media sosial") ||
            lowerName.includes("instagram") ||
            lowerName.includes("facebook") ||
            lowerName.includes("twitter") ||
            lowerName.includes("tiktok") ||
            lowerName.includes("whatsapp")
          ) {
            socialMediaCount += category.items.length;
          } else if (
            lowerName.includes("email") ||
            lowerName.includes("gmail")
          ) {
            emailCount += category.items.length;
          }
        });

        document.getElementById("totalCategories").textContent =
          totalCategories;
        document.getElementById("totalItems").textContent = totalItems;
        document.getElementById("socialMediaCount").textContent =
          socialMediaCount;
        document.getElementById("emailCount").textContent = emailCount;
      }

      // Export data
      function exportData() {
        if (categories.length === 0) {
          alert("Tidak ada data untuk diexport!");
          return;
        }

        const data = {
          version: '1.1',
          exportedAt: new Date().toISOString(),
          user: currentUser,
          categories: categories
        };

        const dataStr = JSON.stringify(data, null, 2);
        const dataUri = 'data:application/json;charset=utf-8,'+ encodeURIComponent(dataStr);

        const exportFileDefaultName = `my-secrets-backup-${new Date().toISOString().split('T')[0]}.json`;

        const linkElement = document.createElement('a');
        linkElement.setAttribute('href', dataUri);
        linkElement.setAttribute('download', exportFileDefaultName);
        linkElement.click();

        alert('Data berhasil diexport!');
      }

      // Import data
      function importData() {
        new bootstrap.Modal(document.getElementById("importModal")).show();
      }

      // Process import
      function processImport() {
        const fileInput = document.getElementById("importFile");
        const password = document.getElementById("importPassword").value;

        if (!fileInput.files.length) {
          alert("Pilih file backup terlebih dahulu!");
          return;
        }

        if (!password) {
          alert("Masukkan master password untuk verifikasi!");
          return;
        }

        // Verify master password
        const savedPass = localStorage.getItem("secretManagerPass");
        if (password !== savedPass) {
          alert("Master password salah!");
          return;
        }

        const file = fileInput.files[0];
        const reader = new FileReader();

        reader.onload = function(e) {
          try {
            const importedData = JSON.parse(e.target.result);
            
            // Basic validation
            if (!importedData.categories || !Array.isArray(importedData.categories)) {
              throw new Error("Format file tidak valid");
            }

            // Backup current data
            const currentBackup = localStorage.getItem(`secretCategories_${currentUser}`);
            
            // Try to import
            localStorage.setItem(`secretCategories_${currentUser}`, JSON.stringify(importedData.categories));
            
            // Reload and verify
            loadUserCategories();
            
            if (categories.length === importedData.categories.length) {
              renderCategories();
              updateStats();
              populateCategorySelect();
              
              // Reset form
              fileInput.value = "";
              document.getElementById("importPassword").value = "";
              
              bootstrap.Modal.getInstance(document.getElementById("importModal")).hide();
              alert("Data berhasil diimport!");
            } else {
              // Restore backup if failed
              localStorage.setItem(`secretCategories_${currentUser}`, currentBackup);
              loadUserCategories();
              throw new Error("Import gagal, data dikembalikan");
            }
          } catch (error) {
            alert("Error: " + error.message);
          }
        };

        reader.readAsText(file);
      }
    </script>
  </body>
</html>